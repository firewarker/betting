<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BettingPro - AI Betting Intelligence</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  
  <style>
    :root {
      --bg-dark: #1a1d29;
      --bg-card: #22253a;
      --bg-card-light: #2a2e45;
      --bg-input: #2f3349;
      --accent-cyan: #3b82f6;
      --accent-blue: #60a5fa;
      --accent-green: #10b981;
      --accent-yellow: #f59e0b;
      --accent-red: #ef4444;
      --accent-purple: #8b5cf6;
      --accent-gold: #fbbf24;
      --accent-emerald: #10b981;
      --text: #f1f5f9;
      --text-white: #f1f5f9;
      --text-gray: #94a3b8;
      --text-dark: #64748b;
      --border: rgba(255,255,255,0.08);
      --glow-cyan: 0 0 15px rgba(59, 130, 246, 0.3);
      --glow-gold: 0 0 20px rgba(251, 191, 36, 0.3);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg-dark);
      background-image: radial-gradient(ellipse at top, rgba(59,130,246,0.08) 0%, transparent 50%),
                        radial-gradient(ellipse at bottom right, rgba(16,185,129,0.08) 0%, transparent 50%);
      color: var(--text-white);
      min-height: 100vh;
      padding-bottom: 100px;
    }
    .header {
      background: rgba(34,37,58,0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 12px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    .header-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .brand-icon {
      width: 40px; height: 40px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.3rem;
    }
    .brand-name {
      font-size: 1.3rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .header-right { display: flex; align-items: center; gap: 16px; }
    .status-bar { display: flex; gap: 12px; }
    .status-item { display: flex; align-items: center; gap: 6px; font-size: 0.7rem; color: var(--text-dark); }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--text-dark); }
    .status-dot.online { background: var(--accent-green); box-shadow: 0 0 8px var(--accent-green); }
    .status-dot.loading { background: var(--accent-yellow); animation: blink 1s infinite; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:.3} }
    .slip-badge {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
      border-radius: 20px;
      font-size: 0.8rem; font-weight: 700;
      cursor: pointer;
    }
    .slip-badge:hover { transform: scale(1.05); }
    .main { max-width: 1400px; margin: 0 auto; padding: 24px; }
    .date-tabs {
      display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap;
    }
    .date-tab {
      padding: 10px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-gray);
      font-size: 0.85rem; font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .date-tab:hover { border-color: var(--accent-cyan); color: var(--text-white); }
    .date-tab.active {
      background: linear-gradient(135deg, rgba(34,211,238,0.2), rgba(59,130,246,0.2));
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }
    .panel {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .panel-title { font-size: 1rem; font-weight: 700; margin-bottom: 16px; color: var(--accent-cyan); }
    .select-field {
      width: 100%;
      padding: 14px 18px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-white);
      font-size: 0.95rem;
      cursor: pointer;
    }
    .select-field:focus { outline: none; border-color: var(--accent-cyan); }
    .matches-list { display: flex; flex-direction: column; gap: 10px; }
    .match-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      background: var(--bg-card-light);
      border: 1px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .match-item:hover {
      border-color: var(--accent-cyan);
      transform: translateX(4px);
    }
    .match-item-left { display: flex; align-items: center; gap: 14px; flex: 1; min-width: 0; }
    .match-item-time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--accent-cyan);
      min-width: 45px;
    }
    .match-item-teams { font-weight: 600; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .match-item-badge {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.65rem;
      font-weight: 700;
      background: var(--bg-input);
      color: var(--text-gray);
      flex-shrink: 0;
    }
    .match-item-badge.live { background: var(--accent-red); color: white; }
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-gray);
      font-size: 0.85rem;
      cursor: pointer;
      margin-bottom: 20px;
    }
    .back-btn:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
    .analysis-hero {
      background: linear-gradient(145deg, var(--bg-card), var(--bg-card-light));
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      text-align: center;
    }
    .hero-league { font-size: 0.8rem; color: var(--text-dark); margin-bottom: 20px; }
    .hero-match { display: flex; align-items: center; justify-content: center; gap: 24px; margin-bottom: 20px; flex-wrap: wrap; }
    .hero-team { display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .hero-team-logo { width: 60px; height: 60px; object-fit: contain; }
    .hero-team-logo-fallback {
      width: 60px; height: 60px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
      border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 1rem;
    }
    .hero-team-name { font-size: 1rem; font-weight: 700; max-width: 120px; text-align: center; }
    
    /* MG NELL'HERO */
    .hero-mg-section {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    .hero-mg-box {
      background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(16,185,129,0.15));
      border: 1px solid var(--accent-gold);
      border-radius: 12px;
      padding: 12px 20px;
      text-align: center;
      min-width: 120px;
    }
    .hero-mg-label {
      font-size: 0.75rem;
      color: var(--accent-gold);
      margin-bottom: 4px;
    }
    .hero-mg-value {
      font-size: 1.3rem;
      font-weight: 800;
      color: var(--accent-gold);
    }
    .hero-mg-prob {
      font-size: 0.85rem;
      color: var(--accent-emerald);
      font-family: 'JetBrains Mono', monospace;
    }
    
    .hero-prediction { display: flex; align-items: center; gap: 10px; }
    .hero-score-box {
      width: 50px; height: 50px;
      background: var(--bg-input);
      border: 2px solid var(--accent-cyan);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.5rem; font-weight: 700;
    }
    .hero-vs { padding: 6px 12px; background: var(--accent-blue); border-radius: 6px; font-weight: 700; font-size: 0.8rem; }
    .analysis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 20px; }
    .analysis-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
    }
    .analysis-card.wide { grid-column: 1 / -1; }
    .card-title {
      display: flex; align-items: center; gap: 10px;
      margin-bottom: 16px;
      font-size: 0.9rem; font-weight: 700;
    }
    .card-title-icon {
      width: 32px; height: 32px;
      background: linear-gradient(135deg, rgba(34,211,238,0.2), rgba(59,130,246,0.2));
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem;
    }
    .card-title-badge {
      margin-left: auto;
      padding: 4px 10px;
      background: var(--accent-cyan);
      border-radius: 6px;
      font-size: 0.7rem; font-weight: 700;
      color: var(--bg-dark);
    }
    .prob-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .prob-row:last-child { margin-bottom: 0; }
    .prob-label { width: 80px; font-size: 0.8rem; color: var(--text-gray); }
    .prob-bar-track { flex: 1; height: 8px; background: var(--bg-input); border-radius: 4px; overflow: hidden; }
    .prob-bar-fill { height: 100%; border-radius: 4px; }
    .prob-bar-fill.cyan { background: linear-gradient(90deg, var(--accent-cyan), var(--accent-blue)); }
    .prob-bar-fill.green { background: linear-gradient(90deg, var(--accent-green), #34d399); }
    .prob-bar-fill.yellow { background: linear-gradient(90deg, var(--accent-yellow), #fcd34d); }
    .prob-bar-fill.purple { background: linear-gradient(90deg, var(--accent-purple), #c084fc); }
    .prob-value {
      width: 50px; text-align: right;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem; font-weight: 600;
      color: var(--accent-cyan);
    }
    .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .stat-box {
      background: var(--bg-card-light);
      border-radius: 10px;
      padding: 12px;
      text-align: center;
    }
    .stat-box-label { font-size: 0.65rem; color: var(--text-dark); margin-bottom: 4px; text-transform: uppercase; }
    .stat-box-value { font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; font-weight: 700; color: var(--accent-cyan); }
    .stat-box-sub { font-size: 0.6rem; color: var(--text-dark); margin-top: 2px; }
    .scores-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 8px; }
    .score-box {
      background: var(--bg-card-light);
      border-radius: 8px;
      padding: 10px 6px;
      text-align: center;
    }
    .score-box.highlight { background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue)); }
    .score-box-value { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; font-weight: 700; }
    .score-box-prob { font-size: 0.6rem; color: var(--text-dark); margin-top: 2px; }
    .score-box.highlight .score-box-prob { color: rgba(255,255,255,0.8); }
    
    /* COMBO SUGGERITE */
    .combo-panel {
      background: linear-gradient(135deg, var(--bg-card), var(--bg-card-light));
      border: 2px solid var(--accent-purple);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
    }
    .combo-title { font-size: 1.1rem; font-weight: 700; color: var(--accent-purple); margin-bottom: 16px; }
    .combo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; }
    .combo-card {
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .combo-card:hover { border-color: var(--accent-purple); transform: translateY(-2px); }
    .combo-card.selected { border-color: var(--accent-green); background: rgba(16,185,129,0.1); }
    .combo-value { font-size: 1rem; font-weight: 700; margin-bottom: 8px; }
    .combo-stats { display: flex; justify-content: center; gap: 12px; font-size: 0.75rem; }
    .combo-prob { color: var(--accent-cyan); }
    .combo-odds { color: var(--accent-green); }
    
    /* MULTIGOAL GRID */
    .multigoal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 10px;
    }
    .multigoal-box {
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 8px;
      text-align: center;
      transition: all 0.2s;
    }
    .multigoal-box.best {
      border-color: var(--accent-green);
      background: rgba(16,185,129,0.1);
    }
    .multigoal-range {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }
    .multigoal-prob {
      font-size: 0.9rem;
      color: var(--accent-cyan);
      font-weight: 600;
    }
    .multigoal-quota {
      font-size: 0.75rem;
      color: var(--accent-green);
      margin-top: 2px;
    }
    
    /* TEMPO GOL */
    .tempo-highlight {
      background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(59,130,246,0.1));
      border: 1px solid var(--accent-purple);
      border-radius: 10px;
      padding: 12px;
      margin-top: 12px;
      text-align: center;
      font-size: 0.85rem;
    }
    .tempo-highlight strong {
      color: var(--accent-cyan);
      margin: 0 6px;
    }
    .tempo-prob {
      color: var(--accent-green);
      font-weight: 600;
    }
    
    /* FORM DISPLAY */
    .form-display {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .form-team {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
    }
    .form-team:last-child { border-bottom: none; }
    .form-team-name {
      font-weight: 600;
      font-size: 0.85rem;
    }
    .form-string {
      display: flex;
      gap: 4px;
    }
    .form-w, .form-d, .form-l {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
    }
    .form-w { background: var(--accent-green); color: white; }
    .form-d { background: var(--accent-yellow); color: #1a1a2e; }
    .form-l { background: var(--accent-red); color: white; }
    
    /* CLASSIFICA E MOTIVAZIONE */
    .standings-card {
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 8px;
    }
    .standings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .standings-position {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--accent-cyan);
    }
    .standings-position sup {
      font-size: 0.7rem;
      color: var(--text-dark);
    }
    .motivation-badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 600;
    }
    .motivation-badge.gold { background: rgba(255,215,0,0.2); color: gold; border: 1px solid gold; }
    .motivation-badge.cyan { background: rgba(6,182,212,0.2); color: var(--accent-cyan); border: 1px solid var(--accent-cyan); }
    .motivation-badge.blue { background: rgba(59,130,246,0.2); color: var(--accent-blue); border: 1px solid var(--accent-blue); }
    .motivation-badge.red { background: rgba(239,68,68,0.2); color: var(--accent-red); border: 1px solid var(--accent-red); }
    .motivation-badge.orange { background: rgba(249,115,22,0.2); color: #f97316; border: 1px solid #f97316; }
    .motivation-badge.gray { background: rgba(156,163,175,0.2); color: var(--text-dark); border: 1px solid var(--border); }
    .standings-stats {
      display: flex;
      gap: 12px;
      font-size: 0.75rem;
      color: var(--text-dark);
    }
    .standings-stat {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* INFORTUNATI */
    .injuries-card {
      background: rgba(239,68,68,0.05);
      border: 1px solid rgba(239,68,68,0.3);
      border-radius: 12px;
      padding: 12px;
    }
    .injuries-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--accent-red);
    }
    .injuries-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .injury-chip {
      background: rgba(239,68,68,0.1);
      border: 1px solid rgba(239,68,68,0.3);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.7rem;
      color: var(--text);
    }
    .no-injuries {
      color: var(--accent-green);
      font-size: 0.8rem;
    }
    
    /* PANNELLO IMPOSTAZIONI */
    .settings-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 320px;
      height: 100vh;
      background: var(--bg-card);
      border-left: 1px solid var(--border);
      padding: 20px;
      z-index: 1000;
      overflow-y: auto;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    .settings-panel.open { transform: translateX(0); }
    .settings-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
      display: none;
    }
    .settings-overlay.open { display: block; }
    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }
    .settings-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text);
    }
    .settings-close {
      background: none;
      border: none;
      color: var(--text-dark);
      font-size: 1.5rem;
      cursor: pointer;
    }
    .settings-section {
      margin-bottom: 20px;
    }
    .settings-section-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent-cyan);
      margin-bottom: 12px;
    }
    .settings-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .settings-label {
      font-size: 0.85rem;
      color: var(--text);
    }
    .settings-input {
      width: 70px;
      padding: 6px 10px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      text-align: center;
    }
    .settings-toggle {
      position: relative;
      width: 44px;
      height: 24px;
      background: var(--bg-input);
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .settings-toggle.active { background: var(--accent-green); }
    .settings-toggle::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }
    .settings-toggle.active::after { transform: translateX(20px); }
    
    /* STORICO WIN RATE */
    .history-chart {
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-top: 12px;
    }
    .history-bars {
      display: flex;
      align-items: flex-end;
      gap: 4px;
      height: 80px;
      margin-bottom: 8px;
    }
    .history-bar {
      flex: 1;
      background: var(--accent-cyan);
      border-radius: 4px 4px 0 0;
      min-height: 4px;
      position: relative;
    }
    .history-bar.won { background: var(--accent-green); }
    .history-bar.lost { background: var(--accent-red); }
    .history-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.65rem;
      color: var(--text-dark);
    }
    
    /* WIN RATE PER SEGNO */
    .winrate-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 16px;
    }
    .winrate-item {
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
    }
    .winrate-label {
      font-weight: 700;
      font-size: 0.85rem;
      color: var(--text-white);
      margin-bottom: 6px;
    }
    .winrate-stats {
      display: flex;
      gap: 12px;
      font-size: 0.75rem;
      color: var(--text-gray);
      margin-bottom: 8px;
    }
    .winrate-won { color: var(--accent-green); }
    .winrate-lost { color: var(--accent-red); }
    .winrate-bar {
      height: 8px;
      background: var(--bg-dark);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 4px;
    }
    .winrate-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s;
    }
    .winrate-bar-fill.good { background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan)); }
    .winrate-bar-fill.bad { background: linear-gradient(90deg, var(--accent-red), var(--accent-yellow)); }
    .winrate-percent {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--accent-cyan);
      text-align: right;
    }
    .winrate-summary {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      padding: 12px;
      background: var(--bg-card);
      border-radius: 10px;
      border: 1px solid var(--border);
    }
    .winrate-summary-item {
      text-align: center;
    }
    .winrate-summary-item span {
      display: block;
      font-size: 0.65rem;
      color: var(--text-dark);
      margin-bottom: 2px;
    }
    .winrate-summary-item strong {
      font-size: 1rem;
      font-weight: 700;
    }
    
    /* SETTINGS BUTTON */
    .settings-btn {
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    .settings-btn:hover {
      border-color: var(--accent-cyan);
      background: rgba(6,182,212,0.1);
    }
    
    /* MG PROBABILE BOX */
    .mg-best-box {
      background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(59,130,246,0.1));
      border: 1px solid var(--accent-purple);
      border-radius: 10px;
      padding: 10px 12px;
      margin-top: 10px;
      text-align: center;
    }
    .mg-best-label {
      font-size: 0.7rem;
      color: var(--text-dark);
      margin-bottom: 4px;
    }
    .mg-best-value {
      font-size: 1rem;
      font-weight: 700;
      color: var(--accent-cyan);
    }
    .mg-best-prob {
      font-size: 0.75rem;
      color: var(--accent-green);
    }
    
    /* MG SOTTO RISULTATI ESATTI */
    .mg-under-scores {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }
    .mg-box-compact {
      flex: 1;
      background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(16,185,129,0.1));
      border: 1px solid var(--accent-gold);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }
    .mg-box-compact .mg-box-label {
      font-size: 0.7rem;
      color: var(--accent-gold);
      margin-bottom: 4px;
    }
    .mg-box-compact .mg-box-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent-gold);
    }
    .mg-box-compact .mg-box-prob {
      font-size: 0.8rem;
      color: var(--accent-emerald);
      font-family: 'JetBrains Mono', monospace;
    }
    
    /* LINEE OVER/UNDER CORNER E CARTELLINI */
    .ou-lines {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .ou-line-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 10px;
      background: var(--bg-input);
      border-radius: 6px;
      font-size: 0.75rem;
    }
    .ou-line-label {
      color: var(--text-gray);
      font-weight: 500;
      flex: 1;
    }
    .ou-line-over, .ou-line-under {
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      margin-left: 6px;
    }
    .ou-line-over {
      background: rgba(16,185,129,0.15);
      color: var(--accent-green);
    }
    .ou-line-under {
      background: rgba(239,68,68,0.15);
      color: var(--accent-red);
    }
    .ou-line-over.highlight {
      background: rgba(16,185,129,0.3);
      border: 1px solid var(--accent-green);
    }
    .ou-line-under.highlight {
      background: rgba(239,68,68,0.3);
      border: 1px solid var(--accent-red);
    }
    
    /* PRONOSTICI AI */
    .predictions-panel {
      background: linear-gradient(135deg, var(--bg-card), var(--bg-card-light));
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
    }
    .predictions-header { text-align: center; margin-bottom: 20px; }
    .predictions-title {
      font-size: 1.3rem; font-weight: 800; margin-bottom: 8px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .predictions-subtitle { font-size: 0.8rem; color: var(--text-dark); }
    .predictions-legend { display: flex; justify-content: center; gap: 16px; margin-top: 10px; font-size: 0.7rem; }
    .legend-item { display: flex; align-items: center; gap: 4px; }
    .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
    .legend-dot.high { background: var(--accent-green); }
    .legend-dot.mid { background: var(--accent-yellow); }
    .legend-dot.low { background: var(--accent-red); }
    .predictions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
    .prediction-card {
      background: var(--bg-input);
      border: 2px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .prediction-card:hover { border-color: var(--accent-cyan); transform: translateY(-2px); }
    .prediction-card.selected { border-color: var(--accent-green); background: rgba(16,185,129,0.15); }
    .prediction-card.selected::after {
      content: 'âœ“';
      position: absolute;
      top: 8px; right: 8px;
      width: 20px; height: 20px;
      background: var(--accent-green);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.7rem; font-weight: 700;
    }
    .prediction-market { font-size: 0.65rem; color: var(--text-dark); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
    .prediction-value { font-size: 1.1rem; font-weight: 800; margin-bottom: 8px; }
    .prediction-prob {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 4px 10px;
      border-radius: 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem; font-weight: 600;
    }
    .prediction-prob.high { background: rgba(16,185,129,0.2); color: var(--accent-green); }
    .prediction-prob.mid { background: rgba(251,191,36,0.2); color: var(--accent-yellow); }
    .prediction-prob.low { background: rgba(239,68,68,0.2); color: var(--accent-red); }
    
    /* HOME SECTIONS - Picks del giorno */
    .home-sections { display: flex; flex-direction: column; gap: 20px; margin-bottom: 24px; }
    .picks-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }
    .picks-section::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
    }
    .picks-section.raddoppi::before { background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan)); }
    .picks-section.gg::before { background: linear-gradient(90deg, var(--accent-yellow), var(--accent-green)); }
    .picks-section.over::before { background: linear-gradient(90deg, var(--accent-cyan), var(--accent-blue)); }
    .picks-section.pareggi::before { background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue)); }
    .picks-section.over1t::before { background: linear-gradient(90deg, var(--accent-red), var(--accent-yellow)); }
    
    /* AI CONSIGLIO */
    .ai-advice {
      background: linear-gradient(135deg, rgba(168,85,247,0.15), rgba(34,211,238,0.15));
      border: 2px solid var(--accent-purple);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    .ai-advice::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent-purple), var(--accent-cyan), var(--accent-green));
    }
    .ai-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .ai-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    .ai-title-group { flex: 1; }
    .ai-title {
      font-size: 1.1rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .ai-subtitle { font-size: 0.75rem; color: var(--text-dark); }
    .ai-confidence {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
    }
    .ai-confidence.high { background: rgba(16,185,129,0.2); color: var(--accent-green); }
    .ai-confidence.medium { background: rgba(251,191,36,0.2); color: var(--accent-yellow); }
    .ai-confidence.low { background: rgba(239,68,68,0.2); color: var(--accent-red); }
    .ai-pick {
      background: var(--bg-input);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      margin-bottom: 16px;
    }
    .ai-pick-label { font-size: 0.7rem; color: var(--text-dark); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
    .ai-pick-value {
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--accent-cyan);
      margin-bottom: 4px;
    }
    .ai-pick-prob {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1rem;
      color: var(--accent-green);
    }
    .ai-reasoning {
      background: var(--bg-card-light);
      border-radius: 12px;
      padding: 16px;
    }
    .ai-reasoning-title {
      font-size: 0.75rem;
      color: var(--text-dark);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .ai-reasoning-list { display: flex; flex-direction: column; gap: 8px; }
    .ai-reason {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.85rem;
      color: var(--text-gray);
    }
    .ai-reason-icon { font-size: 1rem; }
    .ai-reason.positive { color: var(--accent-green); }
    .ai-reason.negative { color: var(--accent-red); }
    .ai-reason.neutral { color: var(--accent-yellow); }
    .ai-alternatives {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    .ai-alt-title { font-size: 0.7rem; color: var(--text-dark); margin-bottom: 10px; }
    .ai-alt-grid { display: flex; gap: 10px; flex-wrap: wrap; }
    .ai-alt-chip {
      padding: 8px 14px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 0.8rem;
      color: var(--text-gray);
      cursor: pointer;
      transition: all 0.2s;
    }
    .ai-alt-chip:hover { border-color: var(--accent-cyan); color: var(--text-white); }
    
    /* LIVE BETTING */
    .live-tab { 
      background: linear-gradient(135deg, var(--accent-red), #ff6b6b) !important; 
      animation: livePulse 2s infinite;
    }
    .live-tab.active { box-shadow: 0 0 20px rgba(239,68,68,0.5); }
    @keyframes livePulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    .live-badge-count {
      background: white;
      color: var(--accent-red);
      font-size: 0.7rem;
      font-weight: 800;
      padding: 2px 6px;
      border-radius: 10px;
      margin-left: 6px;
    }
    .live-section {
      background: linear-gradient(145deg, rgba(239,68,68,0.08), rgba(251,191,36,0.08));
      border: 1px solid rgba(239,68,68,0.3);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .live-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    .live-title {
      font-size: 1.1rem;
      font-weight: 800;
      color: var(--accent-red);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .live-dot {
      width: 10px;
      height: 10px;
      background: var(--accent-red);
      border-radius: 50%;
      animation: livePulse 1s infinite;
    }
    .live-refresh-btn {
      padding: 8px 16px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-gray);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .live-refresh-btn:hover { border-color: var(--accent-cyan); color: var(--text-white); }
    .live-alerts-grid { display: flex; flex-direction: column; gap: 16px; }
    .live-alert-card {
      background: var(--bg-card);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--border);
      transition: all 0.3s;
    }
    .live-alert-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
    .live-alert-card.high { border-color: var(--accent-red); border-width: 2px; }
    .live-alert-card.medium { border-color: var(--accent-yellow); }
    .live-alert-card.low { border-color: var(--accent-cyan); }
    .live-alert-header {
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .live-alert-card.high .live-alert-header { background: rgba(239,68,68,0.15); }
    .live-alert-card.medium .live-alert-header { background: rgba(251,191,36,0.15); }
    .live-alert-card.low .live-alert-header { background: rgba(34,211,238,0.15); }
    .live-alert-level {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .live-alert-card.high .live-alert-level { color: var(--accent-red); }
    .live-alert-card.medium .live-alert-level { color: var(--accent-yellow); }
    .live-alert-card.low .live-alert-level { color: var(--accent-cyan); }
    .live-alert-time {
      display: flex;
      align-items: center;
      gap: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
      color: var(--accent-red);
    }
    .live-alert-body { padding: 16px; }
    .live-alert-match {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .live-alert-teams { font-weight: 600; color: var(--text-white); }
    .live-alert-score {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.2rem;
      font-weight: 800;
      color: var(--accent-cyan);
      background: var(--bg-input);
      padding: 6px 12px;
      border-radius: 8px;
    }
    .live-alert-stats {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 12px;
      padding: 10px;
      background: var(--bg-input);
      border-radius: 10px;
    }
    .live-stat {
      font-size: 0.8rem;
      color: var(--text-gray);
    }
    .live-stat strong { color: var(--text-white); }
    .live-alert-pick {
      background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(34,211,238,0.15));
      border: 1px solid var(--accent-green);
      border-radius: 12px;
      padding: 14px;
      text-align: center;
    }
    .live-pick-label { font-size: 0.7rem; color: var(--text-dark); margin-bottom: 6px; }
    .live-pick-value {
      font-size: 1.3rem;
      font-weight: 800;
      color: var(--accent-green);
    }
    .live-pick-details {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 8px;
      font-size: 0.85rem;
    }
    .live-pick-prob { color: var(--accent-cyan); }
    .live-pick-reason {
      font-size: 0.8rem;
      color: var(--text-gray);
      margin-top: 10px;
      font-style: italic;
    }
    .live-empty {
      text-align: center;
      padding: 40px;
      color: var(--text-dark);
    }
    .live-empty-icon { font-size: 3rem; margin-bottom: 12px; }
    .live-filters {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .live-filter-btn {
      padding: 6px 14px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 0.8rem;
      color: var(--text-gray);
      cursor: pointer;
      transition: all 0.2s;
    }
    .live-filter-btn:hover { border-color: var(--accent-cyan); }
    .live-filter-btn.active { background: var(--accent-cyan); color: var(--bg-dark); border-color: var(--accent-cyan); }
    .live-auto-refresh {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.75rem;
      color: var(--text-dark);
    }
    .live-countdown {
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent-cyan);
    }
    .ai-alt-chip span { color: var(--accent-green); margin-left: 6px; }

    /* DUAL ADVICE LAYOUT */
    .dual-advice-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    @media (max-width: 968px) {
      .dual-advice-container { grid-template-columns: 1fr; }
    }

    /* STATISTICAL ADVICE */
    .statistical-advice {
      background: linear-gradient(135deg, rgba(34,211,238,0.15), rgba(16,185,129,0.15));
      border: 2px solid var(--accent-cyan);
      border-radius: 20px;
      padding: 24px;
      position: relative;
      overflow: hidden;
    }
    .statistical-advice::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent-cyan), var(--accent-green), var(--accent-yellow));
    }

    /* SMART FILTERS */
    .smart-filters-section {
      background: linear-gradient(145deg, rgba(168,85,247,0.08), rgba(34,211,238,0.08));
      border: 1px solid rgba(168,85,247,0.3);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
    }
    .smart-filters-section::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-purple), var(--accent-cyan), var(--accent-green));
    }
    .filters-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .filters-title {
      font-size: 1.1rem;
      font-weight: 800;
      color: var(--accent-purple);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .filters-count {
      padding: 4px 12px;
      background: var(--bg-input);
      border-radius: 12px;
      font-size: 0.75rem;
      color: var(--text-gray);
    }
    .filter-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .filter-btn {
      padding: 10px 20px;
      background: var(--bg-input);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text-gray);
      font-size: 0.85rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    .filter-btn:hover {
      border-color: var(--accent-cyan);
      color: var(--text-white);
      transform: translateY(-2px);
    }
    .filter-btn.active {
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
      border-color: var(--accent-purple);
      color: white;
      box-shadow: 0 4px 15px rgba(168,85,247,0.4);
    }
    .filtered-picks {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 500px;
      overflow-y: auto;
    }
    .filtered-pick-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .filtered-pick-card:hover {
      border-color: var(--accent-cyan);
      transform: translateX(4px);
    }
    .filtered-pick-rank {
      width: 28px;
      height: 28px;
      background: var(--bg-input);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--text-gray);
      flex-shrink: 0;
    }
    .filtered-pick-left {
      flex: 1;
      min-width: 0;
    }
    .filtered-pick-match {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-white);
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .filtered-pick-league {
      font-size: 0.7rem;
      color: var(--text-dark);
    }
    .filtered-pick-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }
    .filtered-pick-bet {
      padding: 6px 14px;
      background: var(--accent-purple);
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 700;
      color: white;
    }
    .filtered-pick-prob {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.1rem;
      font-weight: 800;
      color: var(--accent-green);
      min-width: 55px;
      text-align: right;
    }
    .picks-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .picks-title { display: flex; align-items: center; gap: 10px; font-size: 1rem; font-weight: 700; }
    .picks-title-icon { font-size: 1.3rem; }
    .picks-count { 
      padding: 4px 12px; 
      background: var(--bg-input); 
      border-radius: 12px; 
      font-size: 0.75rem; 
      color: var(--text-gray); 
    }
    .picks-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; }
    .pick-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      background: var(--bg-card-light);
      border: 1px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .pick-card:hover { border-color: var(--accent-cyan); transform: translateX(4px); }
    .pick-card.selected { border-color: var(--accent-green); background: rgba(16,185,129,0.1); }
    .pick-info { flex: 1; min-width: 0; }
    .pick-match { font-size: 0.8rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; }
    .pick-league { font-size: 0.65rem; color: var(--text-dark); }
    .pick-bet { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
    .pick-value { font-weight: 700; color: var(--accent-cyan); }
    .pick-prob { 
      font-family: 'JetBrains Mono', monospace; 
      font-size: 0.75rem; 
      padding: 2px 8px; 
      border-radius: 6px;
      background: rgba(16,185,129,0.2); 
      color: var(--accent-green); 
    }
    
    /* RADDOPPI COMBINATI */
    .raddoppi-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; }
    .raddoppio-card {
      background: linear-gradient(145deg, var(--bg-card-light), var(--bg-input));
      border: 2px solid var(--accent-green);
      border-radius: 14px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .raddoppio-card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(16,185,129,0.2); }
    .raddoppio-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .raddoppio-badge {
      background: var(--accent-green);
      color: var(--bg-dark);
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 0.7rem;
      font-weight: 700;
    }
    .raddoppio-odds {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent-cyan);
    }
    .raddoppio-bets { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
    .raddoppio-bet {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: var(--bg-input);
      border-radius: 8px;
    }
    .raddoppio-match { font-size: 0.8rem; color: var(--text-gray); }
    .raddoppio-pick { 
      font-weight: 700; 
      color: var(--accent-cyan);
      padding: 2px 8px;
      background: rgba(34,211,238,0.15);
      border-radius: 4px;
      font-size: 0.8rem;
    }
    .raddoppio-footer { text-align: center; }
    .raddoppio-prob {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      color: var(--accent-green);
      font-weight: 600;
    }
    
    /* MONEY MANAGEMENT */
    .money-section {
      background: linear-gradient(135deg, var(--bg-card), var(--bg-card-light));
      border: 2px solid var(--accent-purple);
      border-radius: 20px;
      padding: 24px;
    }
    .money-header { text-align: center; margin-bottom: 20px; }
    .money-title { 
      font-size: 1.2rem; font-weight: 800; 
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 6px;
    }
    .money-subtitle { font-size: 0.8rem; color: var(--text-dark); }
    .money-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px; }
    .money-input-group { display: flex; flex-direction: column; gap: 6px; }
    .money-label { font-size: 0.75rem; color: var(--text-gray); text-transform: uppercase; letter-spacing: 0.5px; }
    .money-input {
      padding: 14px 16px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-white);
      font-size: 1.1rem;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
    }
    .money-input:focus { outline: none; border-color: var(--accent-cyan); }
    .money-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; }
    .money-stat {
      background: var(--bg-input);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    .money-stat-label { font-size: 0.65rem; color: var(--text-dark); text-transform: uppercase; margin-bottom: 6px; }
    .money-stat-value { font-family: 'JetBrains Mono', monospace; font-size: 1.3rem; font-weight: 700; }
    .money-stat-value.green { color: var(--accent-green); }
    .money-stat-value.cyan { color: var(--accent-cyan); }
    .money-stat-value.yellow { color: var(--accent-yellow); }
    .money-stat-value.purple { color: var(--accent-purple); }
    .money-strategy { 
      margin-top: 16px; 
      padding: 16px; 
      background: var(--bg-card-light); 
      border-radius: 12px; 
      display: flex; 
      flex-wrap: wrap; 
      gap: 12px; 
      justify-content: center;
    }
    .strategy-btn {
      padding: 10px 20px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-gray);
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .strategy-btn:hover { border-color: var(--accent-cyan); color: var(--text-white); }
    .strategy-btn.active { background: var(--accent-purple); border-color: var(--accent-purple); color: white; }
    
    /* SISTEMA OBIETTIVO */
    .money-grid-4 { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
      gap: 12px; 
      margin-bottom: 20px; 
    }
    .progress-section { margin-bottom: 20px; }
    .progress-bar-container {
      position: relative;
      height: 32px;
      background: var(--bg-input);
      border-radius: 16px;
      overflow: hidden;
    }
    .progress-bar-fill {
      position: absolute;
      top: 0; left: 0; bottom: 0;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan));
      border-radius: 16px;
      transition: width 0.5s;
    }
    .progress-bar-text {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-white);
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
    .stake-section {
      background: linear-gradient(145deg, rgba(34,211,238,0.1), rgba(59,130,246,0.1));
      border: 2px solid var(--accent-cyan);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    .stake-section.warning { border-color: var(--accent-yellow); }
    .stake-section.reached { border-color: var(--accent-green); background: rgba(16,185,129,0.15); }
    .stake-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
      font-size: 0.85rem;
    }
    .stake-label { color: var(--text-gray); font-weight: 600; }
    .stake-remaining { color: var(--accent-cyan); }
    .stake-reached {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--accent-green);
      padding: 20px;
    }
    .stake-value { margin-bottom: 12px; }
    .stake-amount {
      font-family: 'JetBrains Mono', monospace;
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--accent-cyan);
      text-shadow: 0 0 20px rgba(34,211,238,0.5);
    }
    .stake-info { font-size: 0.85rem; color: var(--text-gray); margin-top: 8px; }
    .stake-warning { 
      font-size: 0.8rem; 
      color: var(--accent-yellow); 
      margin-top: 8px;
      padding: 6px 12px;
      background: rgba(251,191,36,0.1);
      border-radius: 8px;
      display: inline-block;
    }
    .stake-preview {
      font-size: 0.9rem;
      color: var(--text-gray);
      margin-bottom: 16px;
    }
    .stake-preview strong { color: var(--accent-green); }
    .stake-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
    .stake-btn {
      padding: 12px 28px;
      border: none;
      border-radius: 10px;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    .stake-btn.win { background: var(--accent-green); color: white; }
    .stake-btn.win:hover { transform: scale(1.05); box-shadow: 0 4px 16px rgba(16,185,129,0.4); }
    .stake-btn.loss { background: var(--accent-red); color: white; }
    .stake-btn.loss:hover { transform: scale(1.05); box-shadow: 0 4px 16px rgba(239,68,68,0.4); }
    .stake-btn.reset { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-gray); }
    .stake-btn.reset:hover { border-color: var(--accent-cyan); color: var(--text-white); }
    
    /* SCHEDINA FLOATING */
    .slip-floating {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: rgba(12,18,34,0.98);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--border);
      padding: 12px 20px;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }
    .slip-count {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px;
      background: var(--accent-cyan);
      border-radius: 20px;
      font-weight: 700;
      color: var(--bg-dark);
    }
    .slip-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 0.85rem; font-weight: 700;
      cursor: pointer;
      display: flex; align-items: center; gap: 6px;
    }
    .slip-btn.primary { background: var(--accent-green); color: white; }
    .slip-btn.secondary { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-white); }
    .slip-btn.danger { background: transparent; border: 1px solid var(--accent-red); color: var(--accent-red); }
    
    /* SLIP MODAL */
    .slip-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .slip-modal-content {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      width: 100%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .slip-modal-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .slip-modal-title { font-size: 1.2rem; font-weight: 700; }
    .slip-modal-close {
      width: 32px; height: 32px;
      background: var(--bg-input);
      border: none;
      border-radius: 8px;
      color: var(--text-gray);
      cursor: pointer;
      font-size: 1.2rem;
    }
    .slip-modal-body { padding: 20px; }
    .slip-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: var(--bg-card-light);
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .slip-item-info { flex: 1; }
    .slip-item-match { font-size: 0.75rem; color: var(--text-dark); margin-bottom: 4px; }
    .slip-item-bet { font-weight: 700; }
    .slip-item-prob { font-size: 0.8rem; color: var(--accent-cyan); }
    .slip-item-remove {
      width: 28px; height: 28px;
      background: transparent;
      border: 1px solid var(--accent-red);
      border-radius: 6px;
      color: var(--accent-red);
      cursor: pointer;
    }
    .slip-total {
      padding: 16px;
      background: var(--bg-input);
      border-radius: 12px;
      text-align: center;
      margin-top: 16px;
    }
    .slip-total-label { font-size: 0.8rem; color: var(--text-dark); margin-bottom: 4px; }
    .slip-total-value { font-size: 1.5rem; font-weight: 800; color: var(--accent-green); }
    
    .loading { display: flex; flex-direction: column; align-items: center; padding: 40px; }
    .spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--accent-cyan); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 12px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { color: var(--text-gray); font-size: 0.9rem; }
    .empty { text-align: center; padding: 40px; color: var(--text-dark); }
    .empty-icon { font-size: 2.5rem; margin-bottom: 12px; }
    
    @media (max-width: 768px) {
      .main { padding: 16px; }
      .header { padding: 10px 16px; }
      .brand-name { font-size: 1.1rem; }
      .status-bar { font-size: 0.65rem; }
      .hero-match { gap: 16px; }
      .hero-team-logo, .hero-team-logo-fallback { width: 50px; height: 50px; }
      .hero-score-box { width: 40px; height: 40px; font-size: 1.2rem; }
      .analysis-grid { grid-template-columns: 1fr; }
      .predictions-grid { grid-template-columns: repeat(2, 1fr); }
      .stat-grid { grid-template-columns: repeat(3, 1fr); }
      .combo-grid { grid-template-columns: repeat(2, 1fr); }
      .slip-floating { flex-wrap: wrap; gap: 10px; padding: 10px 16px; }
    }
    
    /* TRACKING & STATS */
    .track-btn {
      background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 12px;
      width: 100%;
      font-size: 0.95rem;
      transition: all 0.3s;
    }
    .track-btn:hover { transform: scale(1.02); box-shadow: 0 4px 15px rgba(16,185,129,0.4); }
    .track-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .track-btn.tracked { background: var(--text-dark); }
    
    .stats-section {
      background: linear-gradient(145deg, rgba(168,85,247,0.1), rgba(34,211,238,0.1));
      border: 1px solid rgba(168,85,247,0.3);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .stats-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    .stats-title {
      font-size: 1.1rem;
      font-weight: 800;
      color: var(--accent-purple);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .stats-overview {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    .stats-card {
      background: var(--bg-card);
      padding: 16px;
      border-radius: 12px;
      text-align: center;
    }
    .stats-card-value {
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--text-white);
    }
    .stats-card-value.green { color: var(--accent-green); }
    .stats-card-value.red { color: var(--accent-red); }
    .stats-card-value.yellow { color: var(--accent-yellow); }
    .stats-card-label {
      font-size: 0.75rem;
      color: var(--text-gray);
      margin-top: 4px;
    }
    .stats-winrate {
      background: var(--bg-card);
      padding: 20px;
      border-radius: 16px;
      text-align: center;
      margin-bottom: 20px;
    }
    .stats-winrate-value {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .stats-winrate-label {
      font-size: 0.9rem;
      color: var(--text-gray);
    }
    .stats-breakdown {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .stats-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-card);
      padding: 12px 16px;
      border-radius: 10px;
    }
    .stats-row-label {
      font-weight: 600;
      color: var(--text-white);
    }
    .stats-row-value {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .stats-row-wr {
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.85rem;
    }
    .stats-row-wr.good { background: rgba(16,185,129,0.2); color: var(--accent-green); }
    .stats-row-wr.medium { background: rgba(251,191,36,0.2); color: var(--accent-yellow); }
    .stats-row-wr.bad { background: rgba(239,68,68,0.2); color: var(--accent-red); }
    .stats-row-count {
      font-size: 0.8rem;
      color: var(--text-dark);
    }
    .stats-toggle-btn {
      padding: 8px 16px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-gray);
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .stats-toggle-btn:hover { border-color: var(--accent-purple); color: var(--text-white); }
    .stats-toggle-btn.active { background: var(--accent-purple); color: white; border-color: var(--accent-purple); }
    
    .live-track-btn {
      background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      font-size: 0.85rem;
      margin-top: 10px;
      transition: all 0.2s;
    }
    .live-track-btn:hover { transform: scale(1.02); }
    .live-track-btn.tracked { background: var(--text-dark); }
    
    /* === CONSIGLI SECTION === */
    .consigli-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .consigli-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .consigli-title {
      font-size: 1.2rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .consigli-badge {
      padding: 6px 14px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
    }
    .consigli-category {
      background: var(--bg-card-light);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .consigli-category-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }
    .consigli-category-icon {
      font-size: 1.2rem;
    }
    .consigli-category-title {
      font-weight: 700;
      font-size: 0.95rem;
      color: var(--accent-gold);
      flex: 1;
    }
    .consigli-category-count {
      padding: 4px 10px;
      background: var(--bg-input);
      border-radius: 8px;
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-gray);
    }
    .consigli-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .consiglio-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .consiglio-card:hover {
      border-color: var(--accent-gold);
      transform: translateX(4px);
    }
    .consiglio-rank {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.8rem;
      flex-shrink: 0;
    }
    .consiglio-info {
      flex: 1;
      min-width: 0;
    }
    .consiglio-match {
      font-weight: 600;
      font-size: 0.85rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .consiglio-league {
      font-size: 0.7rem;
      color: var(--text-dark);
    }
    .consiglio-bet {
      text-align: right;
      flex-shrink: 0;
    }
    .consiglio-value {
      display: block;
      font-weight: 700;
      font-size: 0.9rem;
      color: var(--accent-gold);
    }
    .consiglio-prob {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--accent-emerald);
    }
    .consigli-tab.active {
      background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(16,185,129,0.2));
      border-color: var(--accent-gold);
      color: var(--accent-gold);
    }
    
    /* === TRADER SECTION === */
    .trader-section {
      background: linear-gradient(135deg, rgba(245,158,11,0.08), rgba(16,185,129,0.08));
      border: 1px solid rgba(245,158,11,0.25);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .trader-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }
    .trader-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .trader-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      box-shadow: var(--glow-gold);
    }
    .trader-title-text h3 {
      font-size: 1.1rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .trader-title-text p {
      font-size: 0.7rem;
      color: var(--text-dark);
    }
    .trader-stats {
      display: flex;
      gap: 16px;
    }
    .trader-stat {
      text-align: center;
    }
    .trader-stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.3rem;
      font-weight: 800;
      color: var(--accent-gold);
    }
    .trader-stat-label {
      font-size: 0.6rem;
      color: var(--text-dark);
      text-transform: uppercase;
    }
    .trader-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 768px) {
      .trader-content { grid-template-columns: 1fr; }
    }
    .trader-box {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
    }
    .trader-box-title {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent-gold);
    }
    .trader-picks {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .trader-pick {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .trader-pick:hover {
      border-color: var(--accent-gold);
      transform: translateX(4px);
    }
    .trader-pick-info {
      flex: 1;
      min-width: 0;
    }
    .trader-pick-match {
      font-size: 0.8rem;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .trader-pick-league {
      font-size: 0.65rem;
      color: var(--text-dark);
    }
    .trader-pick-bet {
      text-align: right;
    }
    .trader-pick-value {
      font-weight: 700;
      color: var(--accent-gold);
      font-size: 0.9rem;
    }
    .trader-pick-prob {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--accent-emerald);
    }
    .trader-combined {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      border-radius: 10px;
      margin-top: 12px;
    }
    .trader-combined-label {
      font-size: 0.75rem;
      font-weight: 600;
    }
    .trader-combined-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.2rem;
      font-weight: 800;
    }
    .trader-strategy {
      font-size: 0.7rem;
      color: var(--text-gray);
      background: var(--bg-input);
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      line-height: 1.5;
    }
    .trader-strategy strong {
      color: var(--accent-gold);
    }
    
    /* === TRADER VERDICT (Analysis Page) === */
    .trader-verdict {
      background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(16,185,129,0.1));
      border: 2px solid rgba(245,158,11,0.3);
      border-radius: 16px;
      padding: 20px;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    .verdict-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .verdict-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: var(--glow-gold);
    }
    .verdict-title {
      flex: 1;
    }
    .verdict-title h3 {
      font-size: 1.1rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-emerald));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .verdict-title p {
      font-size: 0.7rem;
      color: var(--text-dark);
    }
    .verdict-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.85rem;
    }
    .verdict-badge.play { background: rgba(34,197,94,0.2); color: #22c55e; }
    .verdict-badge.caution { background: rgba(234,179,8,0.2); color: #eab308; }
    .verdict-badge.avoid { background: rgba(239,68,68,0.2); color: #ef4444; }
    .verdict-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 768px) {
      .verdict-content { grid-template-columns: 1fr; }
    }
    .verdict-box {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
    }
    .verdict-box-title {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent-gold);
    }
    .verdict-main-pick {
      text-align: center;
      padding: 16px;
      background: var(--bg-input);
      border-radius: 10px;
      margin-bottom: 12px;
    }
    .verdict-main-pick-label {
      font-size: 0.65rem;
      color: var(--text-dark);
      text-transform: uppercase;
      margin-bottom: 6px;
    }
    .verdict-main-pick-value {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--accent-gold);
      margin-bottom: 4px;
    }
    .verdict-main-pick-prob {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.1rem;
      color: var(--accent-emerald);
    }
    .verdict-stars {
      color: var(--accent-gold);
      font-size: 0.9rem;
      margin-top: 6px;
    }
    .verdict-suggestion {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      background: var(--bg-input);
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .verdict-suggestion-icon {
      font-size: 1rem;
    }
    .verdict-suggestion-text {
      font-size: 0.8rem;
      color: var(--text-gray);
    }
    .verdict-suggestion-text strong {
      color: var(--text-white);
    }
    .verdict-warning {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 10px 12px;
      background: rgba(239,68,68,0.1);
      border: 1px solid rgba(239,68,68,0.2);
      border-radius: 8px;
      margin-top: 12px;
    }
    .verdict-warning-icon {
      font-size: 1rem;
      color: var(--accent-red);
    }
    .verdict-warning-text {
      font-size: 0.75rem;
      color: var(--text-gray);
      line-height: 1.4;
    }
    .verdict-warning-text strong {
      color: var(--accent-red);
    }
    
    /* Cache indicator */
    .cache-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: rgba(245,158,11,0.1);
      border-radius: 6px;
      font-size: 0.65rem;
      color: var(--accent-gold);
      margin-left: 10px;
    }
    
    /* === STORICO VARIAZIONI PRONOSTICI === */
    .history-section {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(59, 130, 246, 0.08));
      border: 1px solid rgba(139, 92, 246, 0.25);
      border-radius: 16px;
      padding: 20px;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    .history-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .history-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, var(--accent-purple), #3b82f6);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
    }
    .history-title h3 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-white);
    }
    .history-title p {
      font-size: 0.7rem;
      color: var(--text-dark);
    }
    .history-timeline {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .history-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .history-item.current {
      border-color: var(--accent-gold);
      background: rgba(245, 158, 11, 0.08);
    }
    .history-item.significant {
      border-color: var(--accent-yellow);
      background: rgba(251, 191, 36, 0.08);
    }
    .history-time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.7rem;
      color: var(--text-dark);
      min-width: 50px;
    }
    .history-pick {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .history-pick-value {
      font-weight: 700;
      color: var(--accent-gold);
      font-size: 0.85rem;
    }
    .history-pick-prob {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      padding: 2px 8px;
      background: rgba(16, 185, 129, 0.2);
      color: var(--accent-green);
      border-radius: 4px;
    }
    .history-change {
      font-size: 0.65rem;
      padding: 3px 8px;
      border-radius: 4px;
      font-weight: 600;
      white-space: nowrap;
    }
    .history-change.first { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .history-change.minor { background: rgba(100, 116, 139, 0.2); color: var(--text-gray); }
    .history-change.significant { background: rgba(251, 191, 36, 0.2); color: var(--accent-yellow); }
    .history-change.major { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
    .history-empty {
      text-align: center;
      padding: 20px;
      color: var(--text-dark);
      font-size: 0.85rem;
    }
    .history-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    .history-stat {
      text-align: center;
    }
    .history-stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent-purple);
    }
    .history-stat-label {
      font-size: 0.6rem;
      color: var(--text-dark);
      text-transform: uppercase;
    }
    
    /* Box Confronto Prima vs Ora */
    .history-compare {
      background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(16,185,129,0.15));
      border: 2px solid rgba(245,158,11,0.4);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .history-compare-title {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--accent-gold);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .history-compare-grid {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 12px;
      align-items: center;
    }
    .history-compare-box {
      background: var(--bg-card);
      border-radius: 10px;
      padding: 12px;
      text-align: center;
    }
    .history-compare-box.first {
      border: 1px solid var(--text-dark);
    }
    .history-compare-box.current {
      border: 2px solid var(--accent-gold);
    }
    .history-compare-label {
      font-size: 0.65rem;
      color: var(--text-dark);
      margin-bottom: 4px;
    }
    .history-compare-time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.7rem;
      color: var(--text-gray);
      margin-bottom: 6px;
    }
    .history-compare-pick {
      font-size: 1rem;
      font-weight: 700;
      color: var(--accent-gold);
      margin-bottom: 4px;
    }
    .history-compare-prob {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      color: var(--accent-emerald);
    }
    .history-compare-arrow {
      font-size: 1.5rem;
      color: var(--text-dark);
    }
    .history-compare-arrow.changed {
      color: var(--accent-red);
    }
    .history-compare-arrow.stable {
      color: var(--accent-green);
    }
    .history-compare-verdict {
      text-align: center;
      margin-top: 12px;
      padding: 10px;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    .history-compare-verdict.changed {
      background: rgba(239,68,68,0.15);
      color: var(--accent-red);
    }
    .history-compare-verdict.stable {
      background: rgba(34,197,94,0.15);
      color: var(--accent-green);
    }
    .history-compare-diff {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      margin-top: 4px;
    }
    
    @media (max-width: 600px) {
      .stats-overview { grid-template-columns: repeat(2, 1fr); }
      .history-stats { grid-template-columns: repeat(2, 1fr); }
      .history-compare-grid { grid-template-columns: 1fr; gap: 8px; }
      .history-compare-arrow { transform: rotate(90deg); }
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    // ===================================================
    // BETTINGPRO v5 - COMPLETO CON SCHEDINA E FIREBASE
    // ===================================================
    
    const CONFIG = {
      API_FOOTBALL: {
        key: 'aeb2864a3d4dbb8395fa53c83a876a93',
        baseURL: 'https://v3.football.api-sports.io'
      },
      FOOTYSTATS: {
        key: 'bec59b6f83404b0bd79c40076be71f6f3abec62afdacf5eeba296f2357993f3e',
        baseURL: 'https://api.footystats.org'
      },
      FIREBASE: {
        url: 'https://bettingpro-d0125-default-rtdb.europe-west1.firebasedatabase.app'
      }
    };

    // Generate unique user ID
    const getUserId = () => {
      let id = localStorage.getItem('bettingpro_uid');
      if (!id) {
        id = 'user_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('bettingpro_uid', id);
      }
      return id;
    };
    const USER_ID = getUserId();

    // === FIREBASE INITIALIZATION ===
    const firebaseConfig = {
      apiKey: "AIzaSyD-D8cbJg8Wo9AUceTVLbLGRw_S9aJXTSw",
      authDomain: "bettingpro2.firebaseapp.com",
      projectId: "bettingpro2",
      storageBucket: "bettingpro2.firebasestorage.app",
      messagingSenderId: "364517114484",
      appId: "1:364517114484:web:807d8891ae2aac2e548721"
    };
    
    let db = null;
    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      console.log('ðŸ”¥ Firebase initialized');
    } catch (e) {
      console.warn('âš ï¸ Firebase init failed:', e.message);
    }

    let state = {
      view: 'leagues',
      selectedDate: 0, // 0=oggi, -1=ieri, 1=domani, 2=dopodomani
      leagues: [],
      matches: [],
      selectedLeague: null,
      selectedMatch: null,
      analysis: null,
      loading: false,
      api: { 
        football: localStorage.getItem('api_football_status') || 'offline', 
        footystats: localStorage.getItem('api_footystats_status') || 'offline'
      },
      fsData: new Map(),
      slip: [], // Schedina
      slipModal: false,
      // Picks del giorno
      dailyPicks: { raddoppi: [], gg: [], over25: [], pareggi: [], over1T: [], vittorieCasa: [], vittorieOspite: [] },
      // Money Management - Sistema Obiettivo
      money: {
        bankroll: parseFloat(localStorage.getItem('bp2_bankroll')) || 100,
        target: parseFloat(localStorage.getItem('bp2_target')) || 500,
        totalBets: parseInt(localStorage.getItem('bp2_totalbets')) || 10,
        currentBet: parseInt(localStorage.getItem('bp2_currentbet')) || 1,
        currentOdds: parseFloat(localStorage.getItem('bp2_odds')) || 1.80,
        history: JSON.parse(localStorage.getItem('bp2_history') || '[]')
      },
      // LIVE Betting (deprecato - mantengo variabili per compatibilitÃ )
      consigliMode: false,
      liveMode: false,
      liveMatches: [],
      liveAlerts: [],
      liveLoading: false,
      liveInterval: null,
      liveBackgroundInterval: null,
      countdownInterval: null,
      liveCountdown: 60,
      // Tracking Pronostici
      trackedBets: JSON.parse(localStorage.getItem('bp2_tracked') || '[]'),
      // NUOVO: Cache Classifica e Infortunati
      standingsCache: new Map(),
      injuriesCache: new Map(),
      // NUOVO: Impostazioni soglie configurabili
      settings: JSON.parse(localStorage.getItem('bp2_settings') || JSON.stringify({
        thresholds: {
          '1': 50,
          'X': 28,
          '2': 50,
          'GG': 55,
          'Over 2.5': 50,
          'Over 1.5': 65
        },
        showInjuries: true,
        showStandings: true,
        autoRefresh: true
      })),
      settingsOpen: false,

  smartFilters: {
    active: '1',
    results: []
  },
      statsView: false,
      // TRADER Section
      traderPicks: {
        raddoppio: [],
        singole: []
      },
      // STORICO VARIAZIONI PRONOSTICI
      predictionHistory: JSON.parse(localStorage.getItem('bp2_prediction_history') || '{}')
    };

    // === FUNZIONI STORICO VARIAZIONI ===
    
    function savePredictionToHistory(matchId, matchName, prediction) {
      const key = String(matchId);
      const now = new Date();
      const timestamp = now.toLocaleTimeString('it-IT', {hour:'2-digit', minute:'2-digit'});
      const fullTimestamp = now.getTime();
      
      if (!state.predictionHistory[key]) {
        state.predictionHistory[key] = {
          matchName: matchName,
          date: getDateString(state.selectedDate),
          predictions: []
        };
      }
      
      const history = state.predictionHistory[key].predictions;
      const lastPred = history.length > 0 ? history[history.length - 1] : null;
      
      let changeType = 'first';
      if (lastPred) {
        const pickChanged = lastPred.pick !== prediction.pick;
        const probDiff = Math.abs(prediction.prob - lastPred.prob);
        
        if (pickChanged) {
          changeType = 'major';
        } else if (probDiff >= 10) {
          changeType = 'significant';
        } else if (probDiff >= 3) {
          changeType = 'minor';
        } else {
          return; // Nessun cambiamento rilevante (< 3%)
        }
      }
      
      history.push({
        time: timestamp,
        fullTime: fullTimestamp,
        pick: prediction.pick,
        prob: prediction.prob,
        changeType: changeType
      });
      
      if (history.length > 10) {
        state.predictionHistory[key].predictions = history.slice(-10);
      }
      
      savePredictionHistory();
      console.log('ðŸ“œ Storico:', matchName, changeType, prediction.pick, prediction.prob + '%');
    }
    
    function savePredictionHistory() {
      try {
        const twoDaysAgo = new Date();
        twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
        const cutoffDate = twoDaysAgo.toISOString().split('T')[0];
        
        Object.keys(state.predictionHistory).forEach(key => {
          if (state.predictionHistory[key].date < cutoffDate) {
            delete state.predictionHistory[key];
          }
        });
        
        localStorage.setItem('bp2_prediction_history', JSON.stringify(state.predictionHistory));
      } catch(e) { console.warn('Errore salvataggio storico:', e); }
    }
    
    function getPredictionHistory(matchId) {
      return state.predictionHistory[String(matchId)]?.predictions || [];
    }
    
    function getHistoryStats(matchId) {
      const history = getPredictionHistory(matchId);
      if (history.length === 0) return null;
      
      return {
        totalChanges: history.length - 1,
        majorChanges: history.filter(h => h.changeType === 'major').length,
        significantChanges: history.filter(h => h.changeType === 'significant').length,
        pickChanged: history.length > 1 ? history[0].pick !== history[history.length - 1].pick : false
      };
    }
    
    function renderHistorySection(matchId) {
      const history = getPredictionHistory(matchId);
      const stats = getHistoryStats(matchId);
      
      // Caso: Prima analisi
      if (!history || history.length === 0) {
        return '<div class="history-section">' +
          '<div class="history-header">' +
            '<div class="history-icon">ðŸ“œ</div>' +
            '<div class="history-title">' +
              '<h3>Storico Variazioni</h3>' +
              '<p>Traccia le variazioni dei pronostici nel tempo</p>' +
            '</div>' +
          '</div>' +
          '<div class="history-empty">' +
            'ðŸ“Š <strong>Prima analisi registrata!</strong><br>' +
            '<span style="font-size:0.75rem;color:var(--text-dark);">Riapri questa partita tra qualche ora per vedere eventuali variazioni del pronostico.</span>' +
          '</div>' +
        '</div>';
      }
      
      // Box CONFRONTO PRIMA vs ORA (solo se ci sono almeno 2 registrazioni o 1 con cambio)
      let compareHtml = '';
      const first = history[0];
      const last = history[history.length - 1];
      
      if (history.length >= 1) {
        const pickChanged = first.pick !== last.pick;
        const probDiff = last.prob - first.prob;
        const probDiffAbs = Math.abs(probDiff);
        const hasChanges = history.length > 1;
        
        let arrowClass = 'stable';
        let verdictClass = 'stable';
        let verdictText = 'âœ… Pronostico stabile - Nessuna variazione rilevata';
        
        if (pickChanged) {
          arrowClass = 'changed';
          verdictClass = 'changed';
          verdictText = 'âš ï¸ ATTENZIONE: Il pronostico Ã¨ cambiato!';
        } else if (hasChanges && probDiffAbs >= 10) {
          arrowClass = 'changed';
          verdictClass = 'changed';
          verdictText = 'âš ï¸ Variazione significativa della probabilitÃ ';
        } else if (hasChanges) {
          verdictText = 'âœ… Pronostico confermato con piccole variazioni';
        }
        
        let diffText = '';
        if (hasChanges) {
          if (probDiff > 0) {
            diffText = '<span style="color:var(--accent-green);">+' + probDiff.toFixed(0) + '%</span>';
          } else if (probDiff < 0) {
            diffText = '<span style="color:var(--accent-red);">' + probDiff.toFixed(0) + '%</span>';
          } else {
            diffText = '<span style="color:var(--text-gray);">Â±0%</span>';
          }
        }
        
        compareHtml = '<div class="history-compare">' +
          '<div class="history-compare-title">ðŸ“Š CONFRONTO PRONOSTICI</div>' +
          '<div class="history-compare-grid">' +
            '<div class="history-compare-box first">' +
              '<div class="history-compare-label">PRIMA ANALISI</div>' +
              '<div class="history-compare-time">ðŸ• ' + first.time + '</div>' +
              '<div class="history-compare-pick">' + first.pick + '</div>' +
              '<div class="history-compare-prob">' + first.prob.toFixed(0) + '%</div>' +
            '</div>' +
            '<div class="history-compare-arrow ' + arrowClass + '">' + (hasChanges ? 'â†’' : 'â€¢') + '</div>' +
            '<div class="history-compare-box current">' +
              '<div class="history-compare-label">ORA</div>' +
              '<div class="history-compare-time">ðŸ• ' + last.time + '</div>' +
              '<div class="history-compare-pick">' + last.pick + '</div>' +
              '<div class="history-compare-prob">' + last.prob.toFixed(0) + '%</div>' +
            '</div>' +
          '</div>' +
          '<div class="history-compare-verdict ' + verdictClass + '">' +
            verdictText +
            (hasChanges ? '<div class="history-compare-diff">Differenza: ' + diffText + '</div>' : '') +
          '</div>' +
        '</div>';
      }
      
      // Timeline dettagliata (solo se piÃ¹ di 1 registrazione)
      let historyHtml = '';
      if (history.length > 1) {
        historyHtml = '<div style="font-size:0.75rem;color:var(--text-dark);margin-bottom:10px;font-weight:600;">ðŸ“œ CRONOLOGIA COMPLETA</div>';
        history.forEach(function(item, index) {
          const isLast = index === history.length - 1;
          const isFirst = index === 0;
          const itemClass = isLast ? 'current' : (item.changeType === 'major' || item.changeType === 'significant' ? 'significant' : '');
          
          let changeLabel = '', changeClass = '';
          if (item.changeType === 'first') { changeLabel = '1Â° ANALISI'; changeClass = 'first'; }
          else if (item.changeType === 'minor') { changeLabel = 'â†• Â±3-9%'; changeClass = 'minor'; }
          else if (item.changeType === 'significant') { changeLabel = 'âš ï¸ Â±10%+'; changeClass = 'significant'; }
          else if (item.changeType === 'major') { changeLabel = 'ðŸ”„ CAMBIO!'; changeClass = 'major'; }
          
          historyHtml += '<div class="history-item ' + itemClass + '">' +
            '<span class="history-time">ðŸ• ' + item.time + '</span>' +
            '<div class="history-pick">' +
              '<span class="history-pick-value">' + item.pick + '</span>' +
              '<span class="history-pick-prob">' + item.prob.toFixed(0) + '%</span>' +
            '</div>' +
            '<span class="history-change ' + changeClass + '">' + changeLabel + '</span>' +
          '</div>';
        });
      }
      
      // Statistiche
      let statsHtml = '';
      if (stats && stats.totalChanges > 0) {
        statsHtml = '<div class="history-stats">' +
          '<div class="history-stat"><div class="history-stat-value">' + stats.totalChanges + '</div><div class="history-stat-label">Variazioni</div></div>' +
          '<div class="history-stat"><div class="history-stat-value">' + stats.majorChanges + '</div><div class="history-stat-label">Cambi Pick</div></div>' +
          '<div class="history-stat"><div class="history-stat-value">' + (stats.pickChanged ? 'âš ï¸' : 'âœ…') + '</div><div class="history-stat-label">' + (stats.pickChanged ? 'Cambiato' : 'Stabile') + '</div></div>' +
        '</div>';
      }
      
      return '<div class="history-section">' +
        '<div class="history-header">' +
          '<div class="history-icon">ðŸ“œ</div>' +
          '<div class="history-title"><h3>Storico Variazioni</h3><p>Monitora i cambiamenti del pronostico</p></div>' +
        '</div>' +
        compareHtml +
        (history.length > 1 ? '<div class="history-timeline">' + historyHtml + '</div>' : '') +
        statsHtml +
      '</div>';
    }

    // === UTILITIES ===
    const esc = t => String(t || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[c]));
    const clamp = (min, v, max) => Math.max(min, Math.min(max, v));
    const formatTime = d => d ? new Date(d).toLocaleTimeString('it-IT', {hour:'2-digit', minute:'2-digit'}) : '--:--';
    const formatDate = d => d ? new Date(d).toLocaleDateString('it-IT', {day:'2-digit', month:'2-digit'}) : '--/--';
    const formatDateFull = d => d ? new Date(d).toLocaleDateString('it-IT', {weekday:'short', day:'2-digit', month:'short'}) : '';
    const getInitials = n => n ? n.split(' ').map(w => w[0]).join('').slice(0,3).toUpperCase() : '??';
    
    function getDateString(offset = 0) {
      const d = new Date();
      d.setDate(d.getDate() + offset);
      return d.toISOString().split('T')[0];
    }
    
    function getDateLabel(offset) {
      if (offset === -1) return 'Ieri';
      if (offset === 0) return 'Oggi';
      if (offset === 1) return 'Domani';
      if (offset === 2) return 'Dopodomani';
      return '';
    }

    // Poisson
    const factorial = n => { let r = 1; for (let i = 2; i <= n; i++) r *= i; return r; };
    const poisson = (l, k) => l <= 0 ? (k === 0 ? 1 : 0) : (Math.pow(l, k) * Math.exp(-l)) / factorial(k);

    // === SMART FILTERS - Filtri intelligenti con prob combinata AI + Statistica ===
    function calculateSmartFilters(filterType) {
      if (state.matches.length === 0) return [];
      const results = [];

      state.matches.forEach(match => {
        if (['1H','2H','HT','ET','P','LIVE','FT','AET','PEN'].includes(match.status)) return;

        // xG variabili basati su campionato (stima)
        let homeXG = 1.50, awayXG = 1.15;
        
        // Boost per campionati offensivi noti
        const offensiveLeagues = [39, 140, 135, 78, 61, 88, 94]; // PL, LaLiga, SerieA, Bundesliga, L1, Eredivisie, Primeira
        if (offensiveLeagues.includes(match.league.id)) {
          homeXG = 1.60;
          awayXG = 1.25;
        }
        
        // FootyStats data
        const fsKeys = [
          `${match.home.name.toLowerCase()}${match.away.name.toLowerCase()}`,
          `${match.home.name.toLowerCase().replace(/\s/g, '')}${match.away.name.toLowerCase().replace(/\s/g, '')}`
        ];
        let fsMatch = null;
        for (const k of fsKeys) {
          if (state.fsData.has(k)) {
            fsMatch = state.fsData.get(k);
            break;
          }
        }

        if (fsMatch) {
          if (fsMatch.homexg) homeXG = fsMatch.homexg;
          else if (fsMatch.homeppg) homeXG = fsMatch.homeppg * 0.85;
          else if (fsMatch.avggoalshome) homeXG = fsMatch.avggoalshome;

          if (fsMatch.awayxg) awayXG = fsMatch.awayxg;
          else if (fsMatch.awayppg) awayXG = fsMatch.awayppg * 0.75;
          else if (fsMatch.avggoalsaway) awayXG = fsMatch.avggoalsaway;
        }

        // Home advantage
        homeXG *= 1.12;
        awayXG *= 0.92;
        homeXG = clamp(0.4, homeXG, 3.5);
        awayXG = clamp(0.25, awayXG, 3.0);

        const p1X2 = quickCalc1X2(homeXG, awayXG);
        const pGG = quickCalcBTTS(homeXG, awayXG);
        const pNG = 100 - pGG; // No Goal = 100% - GG
        const pOver15 = quickCalcOver(homeXG, awayXG, 1.5);
        const pOver25 = quickCalcOver(homeXG, awayXG, 2.5);
        const pUnder25 = 100 - pOver25; // Under = 100% - Over

        let prob = 0, pick = '';

        if (filterType === '1') {
          prob = p1X2.home;
          pick = '1';
        } else if (filterType === 'X') {
          prob = p1X2.draw;
          pick = 'X';
        } else if (filterType === '2') {
          prob = p1X2.away;
          pick = '2';
        } else if (filterType === 'GG') {
          prob = pGG;
          pick = 'GG';
        } else if (filterType === 'NG') {
          prob = pNG;
          pick = 'NG';
        } else if (filterType === 'Over 2.5') {
          prob = pOver25;
          pick = 'O 2.5';
        } else if (filterType === 'Under 2.5') {
          prob = pUnder25;
          pick = 'U 2.5';
        } else if (filterType === 'Over 1.5') {
          prob = pOver15;
          pick = 'O 1.5';
        }

        // Aggiungi TUTTE le partite (nessuna soglia)
        results.push({
          match,
          pick,
          prob: prob.toFixed(1),
          time: formatTime(match.date),
          league: `${match.league.country} - ${match.league.name}`
        });
      });

      // Ordina per probabilitÃ  decrescente e prendi le prime 40
      return results.sort((a, b) => parseFloat(b.prob) - parseFloat(a.prob)).slice(0, 40);
    }

    function setSmartFilter(type) {
      state.smartFilters.active = type;
      state.smartFilters.results = calculateSmartFilters(type);
      render();
    }
    
    // Seleziona una partita dal filtro e avvia l'analisi
    function selectMatch(matchId) {
      const match = state.matches.find(m => m.id === matchId);
      if (match) {
        analyzeMatch(match);
      } else {
        console.warn('Partita non trovata:', matchId);
      }
    }

    // === DAILY PICKS - Analisi rapida di tutte le partite ===
    
    // Campionati TOP con dati affidabili (IDs API-Football)
    const TOP_LEAGUES = [
      // Italia
      135, 136, // Serie A, Serie B
      // Inghilterra
      39, 40, 41, // Premier, Championship, League One
      // Spagna
      140, 141, // La Liga, Segunda
      // Germania
      78, 79, // Bundesliga, 2. Bundesliga
      // Francia
      61, 62, // Ligue 1, Ligue 2
      // Altri top
      88,  // Eredivisie (Olanda)
      94,  // Primeira Liga (Portogallo)
      144, // Jupiler Pro (Belgio)
      203, // Super Lig (Turchia)
      // Coppe europee
      2, 3, 848, // Champions, Europa League, Conference
    ];
    
    function calculateDailyPicks() {
      if (state.matches.length === 0) return;
      
      const picks = { raddoppi: [], gg: [], over25: [], pareggi: [], over1T: [], vittorieCasa: [], vittorieOspite: [] };
      const safeBets = []; // Per costruire i raddoppi
      
      // Raccogli i consigli AI per tutte le partite
      const allAdvices = [];
      
      state.matches.forEach(match => {
        // Skip partite giÃ  iniziate o finite
        if (['1H','2H','HT','ET','P','LIVE','FT','AET','PEN'].includes(match.status)) return;
        
        // Calcolo rapido basato su FootyStats se disponibile
        let fsMatch = null;
        const fsKeys = [
          `${match.home.name.toLowerCase()}_${match.away.name.toLowerCase()}`,
          match.home.name.toLowerCase().replace(/\s+/g, '') + '_' + match.away.name.toLowerCase().replace(/\s+/g, '')
        ];
        for (const k of fsKeys) {
          if (state.fsData.has(k)) { fsMatch = state.fsData.get(k); break; }
        }
        
        // Stima xG base
        let homeXG = 1.55, awayXG = 1.25;
        let homeFormMultiplier = 1.0, awayFormMultiplier = 1.0;
        let dataQuality = 'low'; // low, medium, high
        
        if (fsMatch) {
          if (fsMatch.home_xg) {
            homeXG = fsMatch.home_xg;
            dataQuality = 'high';
          } else if (fsMatch.home_ppg) {
            homeXG = fsMatch.home_ppg * 0.8;
            dataQuality = 'medium';
          } else if (fsMatch.avg_goals_home) {
            homeXG = fsMatch.avg_goals_home;
            dataQuality = 'medium';
          }
          
          if (fsMatch.away_xg) {
            awayXG = fsMatch.away_xg;
          } else if (fsMatch.away_ppg) {
            awayXG = fsMatch.away_ppg * 0.7;
          } else if (fsMatch.avg_goals_away) {
            awayXG = fsMatch.avg_goals_away;
          }
          
          // PATTERN CASA/TRASFERTA AVANZATO
          // Analizza performance specifica casa vs trasferta
          if (fsMatch.home_ppg && fsMatch.away_ppg) {
            // Se casa ha ppg alto in casa â†’ boost
            if (fsMatch.home_ppg >= 2.0) homeFormMultiplier = 1.12;
            else if (fsMatch.home_ppg >= 1.5) homeFormMultiplier = 1.06;
            else if (fsMatch.home_ppg <= 0.8) homeFormMultiplier = 0.90;
            
            // Se ospite ha ppg alto in trasferta â†’ boost
            if (fsMatch.away_ppg >= 1.8) awayFormMultiplier = 1.10;
            else if (fsMatch.away_ppg >= 1.2) awayFormMultiplier = 1.04;
            else if (fsMatch.away_ppg <= 0.6) awayFormMultiplier = 0.88;
          }
        }
        
        // Applica moltiplicatori forma
        homeXG *= homeFormMultiplier;
        awayXG *= awayFormMultiplier;
        
        // Home advantage (casa gioca meglio, trasferta peggio)
        homeXG *= 1.10;
        awayXG *= 0.93;
        
        homeXG = clamp(0.3, homeXG, 3.5);
        awayXG = clamp(0.2, awayXG, 3.0);
        
        const totXG = homeXG + awayXG;
        
        // Calcola probabilitÃ 
        const p1X2 = quickCalc1X2(homeXG, awayXG);
        const pOver15 = quickCalcOver(homeXG, awayXG, 1.5);
        const pOver25 = quickCalcOver(homeXG, awayXG, 2.5);
        const pOver35 = quickCalcOver(homeXG, awayXG, 3.5);
        const pUnder25 = 100 - pOver25;
        const pBTTS = quickCalcBTTS(homeXG, awayXG);
        
        const matchInfo = {
          match,
          matchName: `${match.home.name} vs ${match.away.name}`,
          shortName: `${match.home.name.substring(0,12)} - ${match.away.name.substring(0,12)}`,
          league: `${match.league.country} - ${match.league.name}`,
          time: formatTime(match.date),
          xgTotal: totXG.toFixed(2),
          homeXG: homeXG.toFixed(2),
          awayXG: awayXG.toFixed(2)
        };
        
        // === GENERA CONSIGLIO AI RAPIDO (simile a generateAIAdvice) ===
        const homeStrong = homeXG > 1.8;
        const awayWeak = awayXG < 0.8;
        const awayStrong = awayXG > 1.5;
        const homeWeak = homeXG < 1.0;
        const highScoring = totXG >= 3.0;
        const veryHighScoring = totXG >= 3.8;
        const lowScoring = totXG < 2.2;
        const balanced = Math.abs(homeXG - awayXG) < 0.5;
        const ggLikely = pBTTS >= 55 && homeXG > 0.9 && awayXG > 0.9;
        
        // Multigoal per squadra (per calcolo X intelligente)
        const mgHome = quickCalcOver(homeXG, 0, 0.5); // Prob che casa segni almeno 1
        const mgAway = quickCalcOver(awayXG, 0, 0.5); // Prob che ospite segni almeno 1
        
        let aiPick = '';
        let aiProb = 0;
        let confidence = 'low';
        
        // Logica di selezione (come generateAIAdvice) con soglie piÃ¹ alte
        if (homeStrong && awayWeak && p1X2.home >= 68) {
          aiPick = '1 (Vittoria Casa)';
          aiProb = p1X2.home;
          confidence = p1X2.home >= 75 ? 'high' : 'medium';
        }
        else if (awayStrong && homeWeak && p1X2.away >= 63) {
          aiPick = '2 (Vittoria Ospite)';
          aiProb = p1X2.away;
          confidence = p1X2.away >= 70 ? 'high' : 'medium';
        }
        else if (veryHighScoring && pOver25 >= 72) {
          aiPick = 'Over 2.5';
          aiProb = pOver25;
          confidence = pOver25 >= 80 ? 'high' : 'medium';
        }
        else if (ggLikely && pBTTS >= 63) {
          aiPick = 'GG (Entrambe Segnano)';
          aiProb = pBTTS;
          confidence = pBTTS >= 72 ? 'high' : 'medium';
        }
        else if (pOver15 >= 82) {
          aiPick = 'Over 1.5';
          aiProb = pOver15;
          confidence = pOver15 >= 88 ? 'high' : 'medium';
        }
        else if ((p1X2.home + p1X2.draw) >= 82) {
          aiPick = '1X (Casa o Pareggio)';
          aiProb = p1X2.home + p1X2.draw;
          confidence = aiProb >= 88 ? 'high' : 'medium';
        }
        // CALCOLO INTELLIGENTE PER X
        // Se % X Ã¨ alta, MG squadre basse, Under alto â†’ potrebbe essere X
        else if (balanced && p1X2.draw >= 30 && mgHome < 68 && mgAway < 68 && pUnder25 >= 58) {
          aiPick = 'X (Pareggio)';
          aiProb = p1X2.draw;
          confidence = p1X2.draw >= 35 ? 'high' : 'medium';
        }
        else if (pOver15 >= 75) {
          aiPick = 'Over 1.5';
          aiProb = pOver15;
          confidence = 'low';
        }
        
        // CALCOLO CONFIDENCE FINALE basato su qualitÃ  dati + probabilitÃ 
        if (dataQuality === 'high' && aiProb >= 75) confidence = 'high';
        else if (dataQuality === 'high' && aiProb >= 65) {
          if (confidence === 'low') confidence = 'medium';
        }
        else if (dataQuality === 'low' && confidence === 'high') confidence = 'medium';
        
        // Skip pick se probabilitÃ  troppo bassa o confidence troppo bassa
        if (!aiPick || aiProb < 58 || confidence === 'low') return;
        
        // Salva il consiglio AI
        allAdvices.push({
          ...matchInfo,
          aiPick,
          aiProb,
          confidence,
          dataQuality,
          p1X2,
          pOver25,
          pBTTS
        });
        
        // === COSTRUISCI RADDOPPI (solo campionati top) ===
        const isTopLeague = TOP_LEAGUES.includes(match.league.id);
        if (isTopLeague) {
          const p1X = p1X2.home + p1X2.draw;
          const pX2 = p1X2.draw + p1X2.away;
          
          if (p1X >= 72) safeBets.push({ ...matchInfo, bet: '1X', prob: p1X, odds: (100 / p1X).toFixed(2) });
          if (pX2 >= 72) safeBets.push({ ...matchInfo, bet: 'X2', prob: pX2, odds: (100 / pX2).toFixed(2) });
          if (pOver15 >= 75) safeBets.push({ ...matchInfo, bet: 'Over 1.5', prob: pOver15, odds: (100 / pOver15).toFixed(2) });
          if (p1X2.home >= 65) safeBets.push({ ...matchInfo, bet: '1', prob: p1X2.home, odds: (100 / p1X2.home).toFixed(2) });
          if (p1X2.away >= 60) safeBets.push({ ...matchInfo, bet: '2', prob: p1X2.away, odds: (100 / p1X2.away).toFixed(2) });
        }
      });
      
      // === RAGGRUPPA TUTTE LE PROBABILITÃ€ (NON SOLO IL CONSIGLIO PRINCIPALE) ===
      // Questa logica prende TUTTE le probabilitÃ  dalla sezione "PRONOSTICI AI"
      // e le raggruppa per categoria (1, X, 2, GG, Over 2.5)
      allAdvices.forEach(advice => {
        const { p1X2, pOver25, pBTTS, matchInfo, match, confidence, dataQuality } = advice;
        
        // Aggiungi 1 (Vittoria Casa) se probabilitÃ  >= 50%
        if (p1X2.home >= 50) {
          picks.vittorieCasa.push({
            ...matchInfo,
            match,
            bet: '1',
            prob: p1X2.home,
            confidence: p1X2.home >= 70 ? 'high' : (p1X2.home >= 60 ? 'medium' : 'low'),
            dataQuality
          });
        }
        
        // Aggiungi X (Pareggio) se probabilitÃ  >= 25% (i pareggi sono piÃ¹ rari)
        if (p1X2.draw >= 25) {
          picks.pareggi.push({
            ...matchInfo,
            match,
            bet: 'X',
            prob: p1X2.draw,
            confidence: p1X2.draw >= 35 ? 'high' : (p1X2.draw >= 28 ? 'medium' : 'low'),
            dataQuality
          });
        }
        
        // Aggiungi 2 (Vittoria Ospite) se probabilitÃ  >= 45% (in trasferta Ã¨ piÃ¹ difficile)
        if (p1X2.away >= 45) {
          picks.vittorieOspite.push({
            ...matchInfo,
            match,
            bet: '2',
            prob: p1X2.away,
            confidence: p1X2.away >= 65 ? 'high' : (p1X2.away >= 55 ? 'medium' : 'low'),
            dataQuality
          });
        }
        
        // Aggiungi GG se probabilitÃ  >= 52%
        if (pBTTS >= 52) {
          picks.gg.push({
            ...matchInfo,
            match,
            bet: 'GG',
            prob: pBTTS,
            confidence: pBTTS >= 70 ? 'high' : (pBTTS >= 60 ? 'medium' : 'low'),
            dataQuality
          });
        }
        
        // Aggiungi Over 2.5 se probabilitÃ  >= 50%
        if (pOver25 >= 50) {
          picks.over25.push({
            ...matchInfo,
            match,
            bet: 'Over 2.5',
            prob: pOver25,
            confidence: pOver25 >= 70 ? 'high' : (pOver25 >= 60 ? 'medium' : 'low'),
            dataQuality
          });
        }
      });
      
      // === ORDINA E PRENDI I TOP 20 PER OGNI CATEGORIA ===
          a = fsTotal * (1 - ratio);
        }
      }
      
      // MIGLIORAMENTO AVANZATO: PiÃ¹ fattori che influenzano i corner
      
      // 1. Stile di gioco offensivo â†’ PiÃ¹ attacchi â†’ PiÃ¹ corner
      if (homeData.goals >= 2.0) h *= 1.12; // Casa molto attaccante
      else if (homeData.goals >= 1.8) h *= 1.08; // Casa attaccante
      else if (homeData.goals >= 1.5) h *= 1.04; // Casa discretamente attaccante
      
      if (awayData.goals >= 1.8) a *= 1.10; // Ospite molto attaccante
      else if (awayData.goals >= 1.5) a *= 1.06; // Ospite attaccante
      else if (awayData.goals >= 1.2) a *= 1.03; // Ospite discretamente attaccante
      
      // 2. Difese deboli â†’ PiÃ¹ pressione â†’ PiÃ¹ corner subiti
      if (homeData.conceded >= 1.8) a *= 1.08; // Casa subisce molto â†’ ospite attacca â†’ ospite fa corner
      if (awayData.conceded >= 2.0) h *= 1.10; // Ospite subisce molto â†’ casa attacca â†’ casa fa corner
      
      // 3. Squadre difensive chiuse generano meno corner (bloccano prima)
      if (homeData.goals <= 0.9 && homeData.conceded <= 1.0) h *= 0.88; // Casa molto difensiva
      if (awayData.goals <= 0.8 && awayData.conceded <= 0.9) a *= 0.85; // Ospite molto difensiva
      
      // 4. Possesso palla (se disponibile) â†’ PiÃ¹ possesso â†’ PiÃ¹ corner
      if (fsMatch) {
        if (fsMatch.team_a_possession && fsMatch.team_a_possession >= 58) h *= 1.06; // Casa domina
        if (fsMatch.team_b_possession && fsMatch.team_b_possession >= 55) a *= 1.05; // Ospite domina
      }
      
      // 5. Forma recente (xG medio recente indica forma offensiva)
      const homeForm = (homeData.goals / Math.max(homeData.conceded, 0.5));
      const awayForm = (awayData.goals / Math.max(awayData.conceded, 0.5));
      
      if (homeForm >= 1.8) h *= 1.05; // Casa in forma
      if (awayForm >= 1.6) a *= 1.04; // Ospite in forma
      if (homeForm <= 0.6) h *= 0.94; // Casa in crisi
      if (awayForm <= 0.5) a *= 0.92; // Ospite in crisi
      
      h = clamp(2.0, h, 9.0);
      a = clamp(1.5, a, 8.0);
      const total = h + a;
      
      const probs = {};
      
        if (fsMatch.home_cards) h = fsMatch.home_cards;
        if (fsMatch.away_cards) a = fsMatch.away_cards;
      }
      
      // MIGLIORAMENTO AVANZATO: PiÃ¹ fattori che influenzano i cartellini
      
      // 1. Squadre sotto pressione (subiscono gol) â†’ PiÃ¹ falli disperati â†’ PiÃ¹ cartellini
      if (homeData.conceded >= 2.0) h *= 1.14; // Casa subisce molto
      else if (homeData.conceded >= 1.5) h *= 1.10;
      else if (homeData.conceded >= 1.2) h *= 1.05;
      
      if (awayData.conceded >= 2.2) a *= 1.16; // Ospite subisce molto (in trasferta Ã¨ peggio)
      else if (awayData.conceded >= 1.8) a *= 1.12;
      else if (awayData.conceded >= 1.4) a *= 1.07;
      
      // 2. Squadre offensive aggressive (molti gol + molti subiti = partite intense = piÃ¹ falli)
      if (homeData.goals >= 2.0 && homeData.conceded >= 1.3) h *= 1.08;
      if (awayData.goals >= 1.8 && awayData.conceded >= 1.5) a *= 1.10;
      
      // 3. Squadre difensive disciplinate (pochi gol, pochi subiti = gioco controllato = meno falli)
      if (homeData.goals <= 1.0 && homeData.conceded <= 1.0) h *= 0.88;
      if (awayData.goals <= 0.8 && awayData.conceded <= 0.8) a *= 0.85;
      
      // 4. Ritmo di gioco alto â†’ PiÃ¹ cartellini
      // Squadre che segnano + subiscono molto = partite aperte e intense
      const homeIntensity = homeData.goals + homeData.conceded;
      const awayIntensity = awayData.goals + awayData.conceded;
      
      if (homeIntensity >= 3.5) h *= 1.06; // Partite intense casa
      if (awayIntensity >= 3.2) a *= 1.05; // Partite intense ospite
      
      // 5. Partite equilibrate (differenza xG bassa) â†’ PiÃ¹ tensione â†’ PiÃ¹ cartellini
      const balanceDiff = Math.abs(homeData.goals - awayData.goals);
      if (balanceDiff <= 0.3) {
        h *= 1.08; // Partita equilibrata = piÃ¹ tensione
        a *= 1.08;
      }
      
      // 6. Fattore trasferta: squadre ospiti tendono a fare piÃ¹ falli (non sono a casa)
      a *= 1.06;
      
      // 7. Derby / RivalitÃ  (se entrambe hanno alti cartellini medi)
      if (h >= 2.3 && a >= 2.1) {
        h *= 1.10; // Probabilmente partita tesa
        a *= 1.10;
      }
      
      // 8. Importanza della partita (se squadre con alta media gol = squadre forti = partite importanti)
      if (homeData.goals >= 1.8 && awayData.goals >= 1.5) {
        h *= 1.04; // Partita importante
        a *= 1.04;
      }
      
      h = clamp(1.0, h, 5.0);
      a = clamp(0.8, a, 4.5);
      const total = h + a;
      
      const probs = {};
      
              </div>
            </div>
            ` : ''}
            
            <!-- TOP 20 PAREGGI (X) DEL GIORNO -->
            ${picks.pareggi.length > 0 ? `
            <div class="consigli-category">
              <div class="consigli-category-header">
                <span class="consigli-category-icon">ðŸŽ²</span>
                <span class="consigli-category-title">Top 20 Pareggi (X) del Giorno</span>
                <span class="consigli-category-count">${picks.pareggi.length} picks</span>
              </div>
              <div class="consigli-grid">
                ${picks.pareggi.slice(0, 20).map((p, idx) => `
                  <div class="consiglio-card" onclick="selectMatch(${p.match.id})">
                    <div class="consiglio-rank">${idx + 1}</div>
                    <div class="consiglio-info">
                      <div class="consiglio-match">${esc(p.match.home.name)} vs ${esc(p.match.away.name)}</div>
                      <div class="consiglio-league">${p.time} â€¢ ${esc(p.league)}</div>
                    </div>
                    <div class="consiglio-bet">
                      <span class="consiglio-value">X</span>
                      <span class="consiglio-prob">${p.prob.toFixed(0)}%</span>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
            ` : ''}
          `}
        </div>
      `;
    }
    
    function renderLiveSection() {
      if (state.liveLoading) {
        return `
          <div class="live-section">
            <div class="live-header">
              <div class="live-title"><span class="live-dot"></span> LIVE Alerts</div>
            </div>
            <div class="loading"><div class="spinner"></div><div class="loading-text">Caricamento partite live...</div></div>
          </div>
        `;
      }
      
      const alerts = state.liveAlerts;
      
      return `
        <div class="live-section">
          <div class="live-header">
            <div class="live-title"><span class="live-dot"></span> LIVE Alerts</div>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div class="live-auto-refresh">ðŸ”„ Auto-refresh <span class="live-countdown">${state.liveCountdown}s</span></div>
              <button class="live-refresh-btn" id="refreshLive">âŸ³ Aggiorna</button>
            </div>
          </div>
          
          ${alerts.length === 0 ? `
            <div class="live-empty">
              <div class="live-empty-icon">ðŸ“¡</div>
              <div>Nessun alert al momento</div>
              <div style="font-size: 0.8rem; margin-top: 8px; color: var(--text-dark);">
                ${state.liveMatches.length} partite live monitorate
              </div>
            </div>
          ` : `
            <div class="live-alerts-grid">
              ${alerts.map(alert => `
                <div class="live-alert-card ${alert.level}">
                  <div class="live-alert-header">
                    <div class="live-alert-level">${alert.level === 'high' ? 'ðŸš¨ ALERT ALTO' : alert.level === 'medium' ? 'âš ï¸ ALERT MEDIO' : 'ðŸ”µ INFO'}</div>
                    <div class="live-alert-time"><span class="live-dot"></span> ${alert.match.elapsed}'</div>
                  </div>
                  <div class="live-alert-body">
                    <div class="live-alert-match">
                      <div class="live-alert-teams">${esc(alert.match.home.name)} vs ${esc(alert.match.away.name)}</div>
                      <div class="live-alert-score">${alert.match.goals.home} - ${alert.match.goals.away}</div>
                    </div>
                    <div class="live-alert-stats">
                      <div class="live-stat">ðŸŽ¯ Tiri in porta: <strong>${alert.stats.shotsOnHome || 0}-${alert.stats.shotsOnAway || 0}</strong></div>
                      <div class="live-stat">âš½ Tiri totali: <strong>${alert.stats.shotsHome || 0}-${alert.stats.shotsAway || 0}</strong></div>
                      <div class="live-stat">ðŸš© Corner: <strong>${alert.stats.cornersHome || 0}-${alert.stats.cornersAway || 0}</strong></div>
                      <div class="live-stat">ðŸ“Š Possesso: <strong>${alert.stats.possessionHome || 50}%-${alert.stats.possessionAway || 50}%</strong></div>
                    </div>
                    <div class="live-alert-pick">
                      <div class="live-pick-label">CONSIGLIO LIVE</div>
                      <div class="live-pick-value">${alert.pick}</div>
                      <div class="live-pick-details">
                        <span class="live-pick-prob">ðŸ“ˆ ${alert.prob}% prob</span>
                        <span style="color: var(--accent-yellow);">ðŸ’° ~@${alert.quota}</span>
                      </div>
                      <div class="live-pick-reason">ðŸ’¡ ${alert.reason}</div>
                      <button class="live-track-btn ${state.trackedBets.some(b => b.matchId === alert.match.id && b.isLive) ? 'tracked' : ''}"
                              onclick="trackLiveBet(${alert.match.id}, '${esc(alert.match.home.name)} vs ${esc(alert.match.away.name)}', '${esc(alert.pick)}', ${alert.prob}, ${alert.quota}, event)"
                              ${state.trackedBets.some(b => b.matchId === alert.match.id && b.isLive) ? 'disabled' : ''}>
                        ${state.trackedBets.some(b => b.matchId === alert.match.id && b.isLive) ? 'âœ… Tracciato' : 'ðŸŽ¯ GIOCATO'}
                      </button>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          `}
          
          <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
            <div style="font-size: 0.8rem; color: var(--text-dark); margin-bottom: 8px;">ðŸ“Š Statistiche Monitorate</div>
            <div style="display: flex; gap: 16px; flex-wrap: wrap; font-size: 0.85rem; color: var(--text-gray);">
              <span>ðŸ”´ Partite LIVE: <strong style="color: var(--text-white);">${state.liveMatches.length}</strong></span>
              <span>ðŸš¨ Alert Alti: <strong style="color: var(--accent-red);">${alerts.filter(a => a.level === 'high').length}</strong></span>
              <span>âš ï¸ Alert Medi: <strong style="color: var(--accent-yellow);">${alerts.filter(a => a.level === 'medium').length}</strong></span>
            </div>
          </div>
        </div>
      `;
    }

    function renderMatches() {
      const matches = state.matches.filter(m => m.league.id === state.selectedLeague.id).sort((a, b) => a.timestamp - b.timestamp);
      
      return `
        <div class="back-btn" id="backToLeagues">â† Campionati</div>
        <div class="panel">
          <div class="panel-title">âš½ ${esc(state.selectedLeague.country)} - ${esc(state.selectedLeague.name)}</div>
          <div class="matches-list">
            ${matches.map(m => {
              const isLive = ['1H','2H','HT','ET','P','LIVE'].includes(m.status);
              return `
                <div class="match-item" data-id="${m.id}">
                  <div class="match-item-left">
                    <div class="match-item-time">${isLive ? m.elapsed+"'" : formatTime(m.date)}</div>
                    <div class="match-item-teams">${esc(m.home.name)} vs ${esc(m.away.name)}</div>
                  </div>
                  <div class="match-item-badge ${isLive ? 'live' : ''}">${isLive ? 'LIVE' : formatDate(m.date)}</div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    function renderAnalysis() {
      const m = state.selectedMatch;
      const d = state.analysis;
      if (!d) return `<div class="back-btn" id="backToMatches">â† Partite</div><div class="empty">Errore analisi</div>`;
      
      // Genera consiglio AI
      const ai = generateAIAdvice(m, d);
      const stat = generateStatisticalAdvice(m, d);

      return `
        <div class="back-btn" id="backToMatches">â† Partite</div>
        
        <div class="analysis-hero">
          <div class="hero-league">${esc(m.league.country)} â€¢ ${esc(m.league.name)} â€¢ ${formatDateFull(m.date)} ${formatTime(m.date)}</div>
          <div class="hero-match">
            <div class="hero-team">
              ${m.home.logo ? `<img src="${m.home.logo}" class="hero-team-logo" onerror="this.style.display='none'">` : `<div class="hero-team-logo-fallback">${getInitials(m.home.name)}</div>`}
              <div class="hero-team-name">${esc(m.home.name)}</div>
            </div>
            <div class="hero-prediction">
              <div class="hero-score-box">${d.exactScores[0].h}</div>
              <div class="hero-vs">VS</div>
              <div class="hero-score-box">${d.exactScores[0].a}</div>
            </div>
            <div class="hero-team">
              ${m.away.logo ? `<img src="${m.away.logo}" class="hero-team-logo" onerror="this.style.display='none'">` : `<div class="hero-team-logo-fallback">${getInitials(m.away.name)}</div>`}
              <div class="hero-team-name">${esc(m.away.name)}</div>
            </div>
          </div>
          
          <!-- MG CASA / MG OSPITE sotto risultato esatto previsto -->
          <div class="hero-mg-section">
            <div class="hero-mg-box">
              <div class="hero-mg-label">ðŸ  MG ${m.home.name.split(' ')[0]}</div>
              <div class="hero-mg-value">${d.multigoalHome ? d.multigoalHome.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).range : 'N/A'}</div>
              <div class="hero-mg-prob">${d.multigoalHome ? d.multigoalHome.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).prob.toFixed(0) : 0}%</div>
            </div>
            <div class="hero-mg-box">
              <div class="hero-mg-label">âœˆï¸ MG ${m.away.name.split(' ')[0]}</div>
              <div class="hero-mg-value">${d.multigoalAway ? d.multigoalAway.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).range : 'N/A'}</div>
              <div class="hero-mg-prob">${d.multigoalAway ? d.multigoalAway.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).prob.toFixed(0) : 0}%</div>
            </div>
          </div>
        </div>
        
        <!-- DUAL ADVICE: AI + STATISTICAL -->
        <div class="dual-advice-container">

          <!-- AI CONSIGLIO -->
          <div class="ai-advice">
          <div class="ai-header">
            <div class="ai-icon">ðŸ¤–</div>
            <div class="ai-title-group">
              <div class="ai-title">Consiglio AI</div>
              <div class="ai-subtitle">Analisi basata su xG, statistiche e probabilitÃ </div>
            </div>
            <div class="ai-confidence ${ai.confidence}">${ai.confidence === 'high' ? 'ðŸŽ¯ Alta' : ai.confidence === 'medium' ? 'âœ“ Media' : 'âš ï¸ Bassa'}</div>
          </div>
          
          <div class="ai-pick">
            <div class="ai-pick-label">Pronostico Consigliato</div>
            <div class="ai-pick-value">${ai.pick}</div>
            <div class="ai-pick-prob">${ai.prob.toFixed(0)}% probabilitÃ </div>
          </div>
          
          <div class="ai-reasoning">
            <div class="ai-reasoning-title">ðŸ’¡ PerchÃ© questo pronostico</div>
            <div class="ai-reasoning-list">
              ${ai.reasons.map(r => `
                <div class="ai-reason ${r.type}">
                  <span class="ai-reason-icon">${r.type === 'positive' ? 'âœ…' : r.type === 'negative' ? 'âš ï¸' : 'ðŸ“Š'}</span>
                  <span>${r.text}</span>
                </div>
              `).join('')}
            </div>
          </div>
          
          ${ai.alternatives.length > 0 ? `
            <div class="ai-alternatives">
              <div class="ai-alt-title">Alternative valide:</div>
              <div class="ai-alt-grid">
                ${ai.alternatives.map(a => `
                  <div class="ai-alt-chip">${a.pick}<span>${a.prob}%</span></div>
                `).join('')}
              </div>
            </div>
          ` : ''}
          
          <button class="track-btn ${state.trackedBets.some(b => b.matchId === m.id && b.type === 'prematch') ? 'tracked' : ''}" 
                  onclick="trackPrematchBet(${m.id}, '${esc(m.home.name)} vs ${esc(m.away.name)}', '${esc(ai.pick)}', ${ai.prob.toFixed(0)}, event)"
                  ${state.trackedBets.some(b => b.matchId === m.id && b.type === 'prematch') ? 'disabled' : ''}>
            ${state.trackedBets.some(b => b.matchId === m.id && b.type === 'prematch') ? 'âœ… Pronostico Tracciato' : 'ðŸŽ¯ GIOCATO - Traccia questo pronostico'}
          </button>
        </div>

        <!-- PRONOSTICO STATISTICO -->
        <div class="statistical-advice">
          <div class="ai-header">
            <div class="ai-icon">ðŸ“Š</div>
            <div class="ai-title-group">
              <div class="ai-title" style="background: linear-gradient(135deg, var(--accent-cyan), var(--accent-green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Pronostico Statistico</div>
              <div class="ai-subtitle">Basato solo sulla probabilitÃ  piÃ¹ alta</div>
            </div>
            <div class="ai-confidence ${stat.confidence}">${stat.confidence === 'high' ? 'ðŸŽ¯ Alta' : stat.confidence === 'medium' ? 'âœ“ Media' : 'âš ï¸ Bassa'}</div>
          </div>

          <div class="ai-pick">
            <div class="ai-pick-label">Pronostico con Prob. Massima</div>
            <div class="ai-pick-value">${stat.pick}</div>
            <div class="ai-pick-prob">${stat.prob.toFixed(0)}% probabilitÃ </div>
          </div>

          <div class="ai-reasoning">
            <div class="ai-reasoning-title">ðŸ“ˆ Dettagli Statistici</div>
            <div class="ai-reasoning-list">
              <div class="ai-reason positive">
                <span class="ai-reason-icon">âœ…</span>
                <span>Mercato: ${stat.market}</span>
              </div>
              <div class="ai-reason positive">
                <span class="ai-reason-icon">ðŸ“Š</span>
                <span>ProbabilitÃ  piÃ¹ alta tra tutti i pronostici</span>
              </div>
              <div class="ai-reason neutral">
                <span class="ai-reason-icon">ðŸ”¢</span>
                <span>Basato su calcoli Poisson e xG</span>
              </div>
            </div>
          </div>

          ${stat.alternatives.length > 0 ? `
            <div class="ai-alternatives">
              <div class="ai-alt-title">Top 3 alternative:</div>
              <div class="ai-alt-grid">
                ${stat.alternatives.map(a => `
                  <div class="ai-alt-chip">${a.pick}<span>${a.prob}%</span></div>
                `).join('')}
              </div>
            </div>
          ` : ''}
        </div>

      </div>
      
      <!-- TRADER VERDICT -->
      ${renderTraderVerdict(ai, stat, d)}
      
      <!-- STORICO VARIAZIONI -->
      ${renderHistorySection(m.id)}
      
        <div class="combo-panel">
          <div class="combo-title">ðŸ”¥ Combo Suggerite</div>
          <div class="combo-grid">
            ${d.combos.map(c => `
              <div class="combo-card ${isInSlip(m.id, 'combo_'+c.value) ? 'selected' : ''}" data-market="combo_${c.value}" data-value="${c.value}" data-prob="${c.prob.toFixed(0)}">
                <div class="combo-value">${c.value}</div>
                <div class="combo-stats">
                  <span class="combo-prob">${c.prob.toFixed(0)}%</span>
                  <span class="combo-odds">@${c.odds}</span>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div class="analysis-grid">
          <div class="analysis-card">
            <div class="card-title">
              <div class="card-title-icon">ðŸ“Š</div>
              <span>Expected Goals</span>
              <span class="card-title-badge">${d.xG.total.toFixed(2)}</span>
            </div>
            <div class="prob-row">
              <span class="prob-label">${m.home.name.split(' ')[0]}</span>
              <div class="prob-bar-track"><div class="prob-bar-fill cyan" style="width:${(d.xG.home/3)*100}%"></div></div>
              <span class="prob-value">${d.xG.home.toFixed(2)}</span>
            </div>
            <div class="prob-row">
              <span class="prob-label">${m.away.name.split(' ')[0]}</span>
              <div class="prob-bar-track"><div class="prob-bar-fill green" style="width:${(d.xG.away/3)*100}%"></div></div>
              <span class="prob-value">${d.xG.away.toFixed(2)}</span>
            </div>
          </div>
          
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">ðŸŽ¯</div><span>1X2</span></div>
            <div class="prob-row">
              <span class="prob-label">1 Casa</span>
              <div class="prob-bar-track"><div class="prob-bar-fill cyan" style="width:${d.p1X2.home}%"></div></div>
              <span class="prob-value">${d.p1X2.home.toFixed(0)}%</span>
            </div>
            <div class="prob-row">
              <span class="prob-label">X Pari</span>
              <div class="prob-bar-track"><div class="prob-bar-fill yellow" style="width:${d.p1X2.draw}%"></div></div>
              <span class="prob-value">${d.p1X2.draw.toFixed(0)}%</span>
            </div>
            <div class="prob-row">
              <span class="prob-label">2 Ospite</span>
              <div class="prob-bar-track"><div class="prob-bar-fill purple" style="width:${d.p1X2.away}%"></div></div>
              <span class="prob-value">${d.p1X2.away.toFixed(0)}%</span>
            </div>
          </div>
          
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">âš½</div><span>Over/Under & GG</span></div>
            ${[1.5, 2.5, 3.5].map(l => `
              <div class="prob-row">
                <span class="prob-label">O/U ${l}</span>
                <div class="prob-bar-track"><div class="prob-bar-fill cyan" style="width:${d.pOU[l].over}%"></div></div>
                <span class="prob-value">${d.pOU[l].over.toFixed(0)}%</span>
              </div>
            `).join('')}
            <div class="prob-row">
              <span class="prob-label">GG</span>
              <div class="prob-bar-track"><div class="prob-bar-fill green" style="width:${d.pBTTS}%"></div></div>
              <span class="prob-value">${d.pBTTS.toFixed(0)}%</span>
            </div>
          </div>
          
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">ðŸš©</div><span>Corner</span></div>
            <div class="stat-grid">
              <div class="stat-box"><div class="stat-box-label">Casa</div><div class="stat-box-value">${d.corners.home.toFixed(1)}</div><div class="stat-box-sub">media</div></div>
              <div class="stat-box"><div class="stat-box-label">Tot</div><div class="stat-box-value">${d.corners.total.toFixed(1)}</div><div class="stat-box-sub">media</div></div>
              <div class="stat-box"><div class="stat-box-label">Ospite</div><div class="stat-box-value">${d.corners.away.toFixed(1)}</div><div class="stat-box-sub">media</div></div>
            </div>
            <div class="ou-lines" style="margin-top: 12px;">
              ${d.corners.probs ? Object.entries(d.corners.probs).map(([line, p]) => `
                <div class="ou-line-row">
                  <span class="ou-line-label">Corner ${line}</span>
                  <span class="ou-line-over ${p.over >= 55 ? 'highlight' : ''}">O ${p.over.toFixed(0)}%</span>
                  <span class="ou-line-under ${p.under >= 55 ? 'highlight' : ''}">U ${p.under.toFixed(0)}%</span>
                </div>
              `).join('') : ''}
            </div>
          </div>
          
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">ðŸŸ¨</div><span>Cartellini</span></div>
            <div class="stat-grid">
              <div class="stat-box"><div class="stat-box-label">Casa</div><div class="stat-box-value">${d.cards.home.toFixed(1)}</div><div class="stat-box-sub">media</div></div>
              <div class="stat-box"><div class="stat-box-label">Tot</div><div class="stat-box-value">${d.cards.total.toFixed(1)}</div><div class="stat-box-sub">media</div></div>
              <div class="stat-box"><div class="stat-box-label">Ospite</div><div class="stat-box-value">${d.cards.away.toFixed(1)}</div><div class="stat-box-sub">media</div></div>
            </div>
            <div class="ou-lines" style="margin-top: 12px;">
              ${d.cards.probs ? Object.entries(d.cards.probs).map(([line, p]) => `
                <div class="ou-line-row">
                  <span class="ou-line-label">Carte ${line}</span>
                  <span class="ou-line-over ${p.over >= 55 ? 'highlight' : ''}">O ${p.over.toFixed(0)}%</span>
                  <span class="ou-line-under ${p.under >= 55 ? 'highlight' : ''}">U ${p.under.toFixed(0)}%</span>
                </div>
              `).join('') : ''}
            </div>
          </div>
          
          <!-- SEZIONE SCOMMESSE SPECIALI -->
          <div class="analysis-card wide">
            <div class="card-title"><div class="card-title-icon">ðŸŽ°</div><span>Multigoal Range</span></div>
            <div class="multigoal-grid">
              ${d.multigoal ? d.multigoal.slice(0, 6).map((mg, i) => `
                <div class="multigoal-box ${i === 0 ? 'best' : ''}">
                  <div class="multigoal-range">${mg.range}</div>
                  <div class="multigoal-prob">${mg.prob.toFixed(0)}%</div>
                  <div class="multigoal-quota">@${mg.quota}</div>
                </div>
              `).join('') : '<div>N/A</div>'}
            </div>
          </div>
          
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">â±ï¸</div><span>Gol per Tempo</span></div>
            ${d.temporalDistribution ? `
              <div class="prob-row">
                <span class="prob-label">Over 0.5 1Â°T</span>
                <div class="prob-bar-track"><div class="prob-bar-fill cyan" style="width:${d.temporalDistribution.primoTempo.over05}%"></div></div>
                <span class="prob-value">${d.temporalDistribution.primoTempo.over05.toFixed(0)}%</span>
              </div>
              <div class="prob-row">
                <span class="prob-label">Over 0.5 2Â°T</span>
                <div class="prob-bar-track"><div class="prob-bar-fill green" style="width:${d.temporalDistribution.secondoTempo.over05}%"></div></div>
                <span class="prob-value">${d.temporalDistribution.secondoTempo.over05.toFixed(0)}%</span>
              </div>
              <div class="prob-row">
                <span class="prob-label">Over 1.5 1Â°T</span>
                <div class="prob-bar-track"><div class="prob-bar-fill yellow" style="width:${d.temporalDistribution.primoTempo.over15}%"></div></div>
                <span class="prob-value">${d.temporalDistribution.primoTempo.over15.toFixed(0)}%</span>
              </div>
              <div class="tempo-highlight">
                <span>âš¡ Tempo con piÃ¹ gol:</span>
                <strong>${d.temporalDistribution.tempoConPiuGol}</strong>
                <span class="tempo-prob">(${d.temporalDistribution.probTempoConPiuGol.toFixed(0)}%)</span>
              </div>
            ` : '<div>N/A</div>'}
          </div>
          
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">ðŸ </div><span>MG ${m.home.name.split(' ')[0]}</span></div>
            ${d.multigoalHome ? d.multigoalHome.map(mg => `
              <div class="prob-row">
                <span class="prob-label">${mg.range} gol</span>
                <div class="prob-bar-track"><div class="prob-bar-fill cyan" style="width:${mg.prob}%"></div></div>
                <span class="prob-value">${mg.prob.toFixed(0)}%</span>
              </div>
            `).join('') : '<div>N/A</div>'}
          </div>
          
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">âœˆï¸</div><span>MG ${m.away.name.split(' ')[0]}</span></div>
            ${d.multigoalAway ? d.multigoalAway.map(mg => `
              <div class="prob-row">
                <span class="prob-label">${mg.range} gol</span>
                <div class="prob-bar-track"><div class="prob-bar-fill purple" style="width:${mg.prob}%"></div></div>
                <span class="prob-value">${mg.prob.toFixed(0)}%</span>
              </div>
            `).join('') : '<div>N/A</div>'}
          </div>
          
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">ðŸ“ˆ</div><span>Forma + MG Consigliato</span></div>
            <div class="form-display">
              <div class="form-team">
                <span class="form-team-name">${m.home.name.split(' ')[0]}</span>
                <span class="form-string">${d.homeForm ? d.homeForm.split('').map(c => 
                  c === 'W' ? '<span class="form-w">V</span>' : 
                  c === 'D' ? '<span class="form-d">P</span>' : 
                  '<span class="form-l">S</span>'
                ).join('') : 'N/A'}</span>
              </div>
              <div class="form-team">
                <span class="form-team-name">${m.away.name.split(' ')[0]}</span>
                <span class="form-string">${d.awayForm ? d.awayForm.split('').map(c => 
                  c === 'W' ? '<span class="form-w">V</span>' : 
                  c === 'D' ? '<span class="form-d">P</span>' : 
                  '<span class="form-l">S</span>'
                ).join('') : 'N/A'}</span>
              </div>
            </div>
            <!-- MG PIÃ™ PROBABILE -->
            <div style="display: flex; gap: 10px; margin-top: 12px;">
              <div class="mg-best-box" style="flex:1">
                <div class="mg-best-label">ðŸ  MG ${m.home.name.split(' ')[0]}</div>
                <div class="mg-best-value">${d.multigoalHome ? d.multigoalHome.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).range : 'N/A'}</div>
                <div class="mg-best-prob">${d.multigoalHome ? d.multigoalHome.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).prob.toFixed(0) : 0}%</div>
              </div>
              <div class="mg-best-box" style="flex:1">
                <div class="mg-best-label">âœˆï¸ MG ${m.away.name.split(' ')[0]}</div>
                <div class="mg-best-value">${d.multigoalAway ? d.multigoalAway.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).range : 'N/A'}</div>
                <div class="mg-best-prob">${d.multigoalAway ? d.multigoalAway.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).prob.toFixed(0) : 0}%</div>
              </div>
            </div>
          </div>
          
          <!-- CLASSIFICA E MOTIVAZIONE -->
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">ðŸ†</div><span>Classifica</span></div>
            ${d.homePosition ? `
              <div class="standings-card">
                <div class="standings-header">
                  <div>
                    <span style="font-weight:600; font-size:0.85rem;">${m.home.name.split(' ')[0]}</span>
                    <span class="standings-position">${d.homePosition.position}Â°<sup>/${d.homePosition.totalTeams}</sup></span>
                  </div>
                  <span class="motivation-badge ${d.homePosition.motivationColor}">${d.homePosition.motivationText}</span>
                </div>
                <div class="standings-stats">
                  <span class="standings-stat">ðŸ“Š ${d.homePosition.points} pt</span>
                  <span class="standings-stat">âœ… ${d.homePosition.won}V</span>
                  <span class="standings-stat">âž– ${d.homePosition.draw}P</span>
                  <span class="standings-stat">âŒ ${d.homePosition.lost}S</span>
                </div>
              </div>
            ` : '<div class="standings-card"><span style="color:var(--text-dark)">Classifica non disponibile</span></div>'}
            ${d.awayPosition ? `
              <div class="standings-card">
                <div class="standings-header">
                  <div>
                    <span style="font-weight:600; font-size:0.85rem;">${m.away.name.split(' ')[0]}</span>
                    <span class="standings-position">${d.awayPosition.position}Â°<sup>/${d.awayPosition.totalTeams}</sup></span>
                  </div>
                  <span class="motivation-badge ${d.awayPosition.motivationColor}">${d.awayPosition.motivationText}</span>
                </div>
                <div class="standings-stats">
                  <span class="standings-stat">ðŸ“Š ${d.awayPosition.points} pt</span>
                  <span class="standings-stat">âœ… ${d.awayPosition.won}V</span>
                  <span class="standings-stat">âž– ${d.awayPosition.draw}P</span>
                  <span class="standings-stat">âŒ ${d.awayPosition.lost}S</span>
                </div>
              </div>
            ` : ''}
          </div>
          
          <!-- INFORTUNATI -->
          <div class="analysis-card">
            <div class="card-title"><div class="card-title-icon">ðŸ¥</div><span>Assenze</span></div>
            <div class="injuries-card" style="margin-bottom: 8px;">
              <div class="injuries-header">
                <span>ðŸ  ${m.home.name.split(' ')[0]}</span>
              </div>
              ${d.homeInjuries && d.homeInjuries.length > 0 ? `
                <div class="injuries-list">
                  ${d.homeInjuries.slice(0, 5).map(inj => `
                    <span class="injury-chip">âŒ ${inj.player}</span>
                  `).join('')}
                  ${d.homeInjuries.length > 5 ? `<span class="injury-chip">+${d.homeInjuries.length - 5} altri</span>` : ''}
                </div>
              ` : '<span class="no-injuries">âœ… Rosa completa</span>'}
            </div>
            <div class="injuries-card">
              <div class="injuries-header">
                <span>âœˆï¸ ${m.away.name.split(' ')[0]}</span>
              </div>
              ${d.awayInjuries && d.awayInjuries.length > 0 ? `
                <div class="injuries-list">
                  ${d.awayInjuries.slice(0, 5).map(inj => `
                    <span class="injury-chip">âŒ ${inj.player}</span>
                  `).join('')}
                  ${d.awayInjuries.length > 5 ? `<span class="injury-chip">+${d.awayInjuries.length - 5} altri</span>` : ''}
                </div>
              ` : '<span class="no-injuries">âœ… Rosa completa</span>'}
            </div>
          </div>
          
          <div class="analysis-card wide">
            <div class="card-title"><div class="card-title-icon">ðŸŽ²</div><span>Risultati Esatti</span></div>
            <div class="scores-grid">
              ${d.exactScores.map((s, i) => `
                <div class="score-box ${i === 0 ? 'highlight' : ''}">
                  <div class="score-box-value">${s.h}-${s.a}</div>
                  <div class="score-box-prob">${s.p.toFixed(1)}%</div>
                </div>
              `).join('')}
            </div>
            <!-- MG CASA / MG OSPITE sotto risultati esatti -->
            <div class="mg-under-scores">
              <div class="mg-box-compact">
                <div class="mg-box-label">ðŸ  MG ${m.home.name.split(' ')[0]}</div>
                <div class="mg-box-value">${d.multigoalHome ? d.multigoalHome.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).range : 'N/A'}</div>
                <div class="mg-box-prob">${d.multigoalHome ? d.multigoalHome.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).prob.toFixed(0) : 0}%</div>
              </div>
              <div class="mg-box-compact">
                <div class="mg-box-label">âœˆï¸ MG ${m.away.name.split(' ')[0]}</div>
                <div class="mg-box-value">${d.multigoalAway ? d.multigoalAway.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).range : 'N/A'}</div>
                <div class="mg-box-prob">${d.multigoalAway ? d.multigoalAway.reduce((best, mg) => mg.prob > best.prob ? mg : best, {range:'N/A', prob:0}).prob.toFixed(0) : 0}%</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="predictions-panel">
          <div class="predictions-header">
            <div class="predictions-title">âš½ PRONOSTICI AI</div>
            <div class="predictions-subtitle">Clicca per aggiungere alla schedina</div>
            <div class="predictions-legend">
              <div class="legend-item"><span class="legend-dot high"></span> Alta (&gt;65%)</div>
              <div class="legend-item"><span class="legend-dot mid"></span> Media (50-65%)</div>
              <div class="legend-item"><span class="legend-dot low"></span> Bassa (&lt;50%)</div>
            </div>
          </div>
          <div class="predictions-grid">
            ${d.predictions.map(p => `
              <div class="prediction-card ${isInSlip(m.id, p.market) ? 'selected' : ''}" data-market="${p.market}" data-value="${p.value}" data-prob="${p.prob.toFixed(0)}">
                <div class="prediction-market">${p.market}</div>
                <div class="prediction-value">${p.value}</div>
                <div class="prediction-prob ${getProbClass(p.prob)}">${p.prob.toFixed(0)}%</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function renderSlipFloating() {
      if (state.slip.length === 0) return '';
      return `
        <div class="slip-floating">
          <div class="slip-count">ðŸŽ« ${state.slip.length} pronostici</div>
          <button class="slip-btn primary" id="viewSlip">ðŸ“‹ Vedi</button>
          <button class="slip-btn secondary" id="copySlip">ðŸ“‹ Copia</button>
          <button class="slip-btn danger" id="clearSlip">ðŸ—‘ï¸</button>
        </div>
      `;
    }

    function renderSlipModal() {
      const totalProb = state.slip.reduce((acc, s) => acc * (s.prob / 100), 1) * 100;
      return `
        <div class="slip-modal" id="slipModal">
          <div class="slip-modal-content">
            <div class="slip-modal-header">
              <div class="slip-modal-title">ðŸŽ« La Tua Schedina</div>
              <button class="slip-modal-close" id="closeSlip">Ã—</button>
            </div>
            <div class="slip-modal-body">
              ${state.slip.map(s => `
                <div class="slip-item">
                  <div class="slip-item-info">
                    <div class="slip-item-match">${esc(s.matchName)}</div>
                    <div class="slip-item-bet">${s.market}: ${s.value}</div>
                    <div class="slip-item-prob">${s.prob}%</div>
                  </div>
                  <button class="slip-item-remove" data-key="${s.key}">Ã—</button>
                </div>
              `).join('')}
              <div class="slip-total">
                <div class="slip-total-label">ProbabilitÃ  Combinata</div>
                <div class="slip-total-value">${totalProb.toFixed(2)}%</div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function attachEvents() {
      // LIVE Tab
      // Consigli Tab
      document.getElementById('consigliTab')?.addEventListener('click', toggleConsigliMode);
      document.getElementById('refreshLive')?.addEventListener('click', loadLiveMatches);
      
      // Date tabs
      document.querySelectorAll('.date-tab[data-date]').forEach(tab => {
        tab.addEventListener('click', () => {
          if (state.liveMode) {
            state.liveMode = false;
            stopLiveAutoRefresh();
          }
          state.consigliMode = false; // Disattiva anche consigli mode
          loadMatches(parseInt(tab.dataset.date));
        });
      });
      
      // League select
      document.getElementById('leagueSelect')?.addEventListener('change', e => {
        const id = parseInt(e.target.value);
        if (id) {
          state.selectedLeague = state.leagues.find(l => l.id === id);
          state.view = 'matches';
          render();
        }
      });
      
      // Back buttons
      document.getElementById('backToLeagues')?.addEventListener('click', () => {
        state.view = 'leagues';
        state.selectedLeague = null;
        render();
      });
      
      document.getElementById('backToMatches')?.addEventListener('click', () => {
        state.view = 'matches';
        state.selectedMatch = null;
        state.analysis = null;
        render();
      });
      
      // Match items
      document.querySelectorAll('.match-item').forEach(el => {
        el.addEventListener('click', () => {
          const m = state.matches.find(x => x.id === parseInt(el.dataset.id));
          if (m) analyzeMatch(m);
        });
      });
      
      // PICK CARDS nella home - aggiungi alla schedina
      document.querySelectorAll('.pick-card').forEach(el => {
        el.addEventListener('click', () => {
          const matchId = parseInt(el.dataset.matchid);
          const match = state.matches.find(m => m.id === matchId);
          if (match) {
            addToSlip(match, el.dataset.market, el.dataset.value, parseFloat(el.dataset.prob));
          }
        });
      });
      
      // RADDOPPI COMBINATI - aggiungi tutte le scommesse alla schedina
      document.querySelectorAll('.raddoppio-card').forEach(el => {
        el.addEventListener('click', () => {
          const idx = parseInt(el.dataset.raddoppio);
          const raddoppio = state.dailyPicks.raddoppi[idx];
          if (raddoppio) {
            raddoppio.bets.forEach(b => {
              addToSlip(b.match, 'radd_' + b.bet, b.bet, b.prob);
            });
          }
        });
      });
      
      // Predictions click to add (nella pagina analisi)
      document.querySelectorAll('.prediction-card, .combo-card').forEach(el => {
        el.addEventListener('click', () => {
          const m = state.selectedMatch;
          if (m) addToSlip(m, el.dataset.market, el.dataset.value, parseFloat(el.dataset.prob));
        });
      });
      
      // MONEY MANAGEMENT
      document.getElementById('bankrollInput')?.addEventListener('change', e => {
        state.money.bankroll = parseFloat(e.target.value) || 100;
        saveMoney();
        render();
      });
      
      document.getElementById('targetInput')?.addEventListener('change', e => {
        state.money.target = parseFloat(e.target.value) || 500;
        saveMoney();
        render();
      });
      
      document.getElementById('totalBetsInput')?.addEventListener('change', e => {
        state.money.totalBets = parseInt(e.target.value) || 10;
        saveMoney();
        render();
      });
      
      document.getElementById('oddsInput')?.addEventListener('change', e => {
        state.money.currentOdds = parseFloat(e.target.value) || 1.80;
        saveMoney();
        render();
      });
      
      // BET RESULT BUTTONS
      document.getElementById('betWin')?.addEventListener('click', () => recordBetResult(true));
      document.getElementById('betLoss')?.addEventListener('click', () => recordBetResult(false));
      document.getElementById('betReset')?.addEventListener('click', resetMoney);
      
      // Slip actions
      document.getElementById('openSlip')?.addEventListener('click', () => { state.slipModal = true; render(); });
      document.getElementById('viewSlip')?.addEventListener('click', () => { state.slipModal = true; render(); });
      document.getElementById('closeSlip')?.addEventListener('click', () => { state.slipModal = false; render(); });
      document.getElementById('slipModal')?.addEventListener('click', e => { if (e.target.id === 'slipModal') { state.slipModal = false; render(); }});
      document.getElementById('clearSlip')?.addEventListener('click', clearSlip);
      
      document.getElementById('copySlip')?.addEventListener('click', () => {
        const text = state.slip.map(s => `${s.matchName}: ${s.market} ${s.value} (${s.prob}%)`).join('\n');
        navigator.clipboard.writeText(text);
        alert('Schedina copiata!');
      });
      
      // Remove from slip
      document.querySelectorAll('.slip-item-remove').forEach(btn => {
        btn.addEventListener('click', () => removeFromSlip(btn.dataset.key));
      });
    }

    // === INIT ===
    async function init() {
      console.log('ðŸš€ BettingPro v5 starting...');
      
      // Check API status FIRST
      await checkAPIStatus();
      
      await loadSlipFromFirebase();
      
      // Carica pronostici tracciati da Firebase
      await loadTrackingFromFirebase();
      
      render();
      await loadMatches(0);
      
      // LIVE monitoring disabilitato (sezione LIVE rimossa)
      // startLiveBackgroundMonitoring();
      // console.log('ðŸ“¡ LIVE background monitoring started');
      
      // Controlla risultati dei pronostici pendenti
      await checkPendingResults();
      console.log('ðŸ“Š Pending results checked');
      
      // Controlla risultati ogni 10 minuti
      setInterval(() => {
        checkPendingResults();
        console.log('ðŸ”„ Auto-check pending results');
      }, 10 * 60 * 1000);
    }

    init();
  </script>
</body>
</html>
